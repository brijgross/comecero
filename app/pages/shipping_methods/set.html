<div ng-controller="ShippingMethodsSetCtrl" class="content container">

    <div class="callout callout-danger" ng-if="exception.error">
        <h4 translate>Oops! We had a problem.</h4>
        <p>{{exception.error.message}}</p>
        <span class="error-code" ng-if="exception.error.reference">Error code: {{exception.error.reference}}</span>
    </div>

    <div class="page-header"> 
        <h1 ng-if="add" translate>Add a ShippingMethod</h1>
        <h1 ng-if="update" translate>ShippingMethod: {{shippingMethod.shipping_method_id}}</h1>
    </div>
    <form name="form" novalidate>
        <div class="panel panel-body light-shadow">
            
            <div class="col-xs-12">
                <div class="form-group" show-errors>
                    <label for="description" class="control-label" translate>Description</label>
                    <input type="text" class="form-control" name="description" ng-model="shippingMethod.description">
                    <p class="help-block hidden fadeInDown" translate>Please provide a valid state</p>
                    <div>
                        <p class="help-text" translate>For your use in identifying the shipping method.</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label for="details" class="control-label" translate>Details</label>
                    <textarea type="text" class="form-control no-wrap" name="details" ng-model="shippingMethod.details"></textarea>
                    <p class="help-block hidden fadeInDown" translate>Please provide a shipping method details.</p>
                    <div>
                        <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                    </div>
                </div>
            </div>

            <div class="col-xs-12">
                <div class="form-group spacer-b10">
                    <label for="shipping_method_countries" class="control-label" translate>Countries</label>
                    <input type="text" class="form-control" name="shipping_method_countries" ng-model="typeahead.shipping_method_countries" uib-typeahead="country as country.name + ' (' + country.code + ')' for country in countries | filter:$viewValue | limitTo:12" typeahead-input-formatter="$model.name" typeahead-on-select="onCountrySelect($item, $model, $label, 'shipping_method_countries')" typeahead-editable="false">
                    <div>
                        <p class="help-text" translate>Supply the countries where you want prices to be tax inclusive. Note that 'All countries' and 'European Union' are options you can select.</p>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <span ng-repeat="country in models.shipping_method_countries">
                        <span href="#" class="label label-success label-lg" title="{{country.name}} ({{country.code}})">{{country.name}}<i class="fa fa-times-circle pointer spacer-l20" ng-click="removeCountry(country, 'shipping_method_countries')"></i></span>
                    </span>
                </div>
            </div>

            <div class="row"></div>
            <hr />
            <div class="row"></div>

            <!-- Adjustments section -->
            <div ng-if="adjustmentCountries.length">
                <div class="col-xs-12">
                    <div class="form-group spacer-b10">
                        <a class="btn btn-primary" ng-click="addNewAdjustment()" translate>Add a new adjustment</a>
                    </div>
                </div>
                <div class="col-xs-12">
                    <hr />
                </div>
                <div ng-repeat="adjustment in shippingMethod.adjustments">
                    <ng-form name="adjustments">
                         <div class="col-xs-12">
                            <div class="form-group">
                                <label for="country" class="control-label" translate>Country</label>
                                <select name="country" class="form-control" ng-model="adjustment.country" ng-options="country.code as country.name for country in $parent.adjustmentCountries"></select>
                                <p class="help-block hidden fadeInDown" translate>Please select a country</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12" ng-if="adjustment.country == 'US'">
                            <div class="form-group" show-errors>
                                <label for="state_prov" class="control-label" translate>State</label>
                                <input type="text" class="form-control" name="state_prov" ng-model="adjustment.typeahead.state_prov" uib-typeahead="state as state.name for state in $parent.us_states | filter:$viewValue | limitTo:8" typeahead-input-formatter="$model.name" typeahead-on-select="$parent.onStateSelect(adjustment, $item, $model, $label)" typeahead-editable="false" >
                                <p class="help-block hidden fadeInDown" translate>Please provide a valid state</p>
                            </div>
                        </div>

                        <div class="col-xs-12" ng-if="adjustment.country == 'CA'">
                            <div class="form-group" show-errors>
                                <label for="state_prov" class="control-label" translate>Province</label>
                                <input type="text" class="form-control" name="state_prov" ng-model="adjustment.typeahead.state_prov" uib-typeahead="state as state.name for state in $parent.ca_provinces | filter:$viewValue | limitTo:8" typeahead-input-formatter="$model.name" typeahead-on-select="$parent.onStateSelect(adjustment, $item, $model, $label)" typeahead-editable="false" >
                                <p class="help-block hidden fadeInDown" translate>Please provide a valid state</p>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <span ng-repeat="state in adjustment._states">
                                    <span href="#" class="label label-success label-lg" title="{{state.name}} ({{state.code}})">{{state.name}}<i class="fa fa-times-circle pointer spacer-l20" ng-click="$parent.removeState(adjustment, state)"></i></span>
                                </span>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label class="radio-group-label required" translate>Adjustment Type</label>
                                <div class="radio-group ">
                                    <input type="radio" id="adjustment_type-1" class="radio" name="adjustment_type_{{$index}}" ng-model="adjustment.adjustment_type" value="percentage" required>
                                    <label for="adjustment_type-1" class="radio-label" translate>Percentage</label>
                                    <input type="radio" id="adjustment_type-2" class="radio" name="adjustment_type_{{$index}}" ng-model="adjustment.adjustment_type" value="amounts" required>
                                    <label for="adjustment_type-2" class="radio-label" translate>Use amounts I specify</label>
                                </div>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12" ng-if="adjustment.adjustment_type == 'percentage'">
                            <div class="form-group" show-errors>
                                <label for="percentage" class="control-label" translate>Percentage</label>
                                <input type="tel" class="form-control" name="percentage" ng-model="adjustment.percentage" required>
                                <p class="help-block hidden fadeInDown" translate>Please provide a valid percentage</p>
                            </div>
                        </div>
                        <div prices="adjustment.amounts" currencies="$parent.currencies" ng-if="adjustment.adjustment_type == 'amounts'"></div>
                        <div class="row"></div>

                        <div class="text-right">
                            <span class="delete" ng-click="$parent.confirmDelete(removeAdjustment, adjustment, $index)">Delete this adjustment</span>
                        </div>
                        <hr />

                        <div class="row"></div>
                    </ng-form>
                </div>
            </div>

            <!-- End of Adjustments section -->

            <div class="col-xs-12">
                <div class="form-group">
                    <label class="radio-group-label required" translate>Shipping Config Type</label>
                    <div class="radio-group ">
                        <input type="radio" id="shipping_method_config_type-1" class="radio" name="shipping_method_config_type" ng-model="shipping_method_config_type" value="subtotal" required>
                        <label for="shipping_method_config_type-1" class="radio-label" translate>Subtotal</label>
                        <input type="radio" id="shipping_method_config_type-2" class="radio" name="shipping_method_config_type" ng-model="shipping_method_config_type" value="quantity" required>
                        <label for="shipping_method_config_type-2" class="radio-label" translate>Quantity</label>
                        <input type="radio" id="shipping_method_config_type-3" class="radio" name="shipping_method_config_type" ng-model="shipping_method_config_type" value="weight" required>
                        <label for="shipping_method_config_type-3" class="radio-label" translate>Weight</label>
                    </div>
                    <div>
                        <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                    </div>
                </div>
            </div>

            <!-- Subtotal config section -->
            <div ng-if="shipping_method_config_type == 'subtotal'">
                <div class="col-xs-12">
                    <div class="form-group" show-errors>
                        <label for="percent_of_subtotal" class="control-label" translate>Percent of total</label>
                        <input type="tel" class="form-control" name="percent_of_subtotal" ng-model="shippingMethod.subtotal_config.percent_of_subtotal" required>
                        <p class="help-block hidden fadeInDown" translate>Please provide a valid state</p>
                        <div>
                            <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                        </div>
                    </div>

                </div>
                <div class="col-xs-12">
                    <div class="form-group spacer-b10">
                        <a class="btn btn-primary" ng-click="addNewRule('subtotal_config')" translate>Add a new subtotal rule</a>
                    </div>
                </div>

                <div class="col-xs-12">
                    <hr />
                </div>
                <div class="col-xs-12" ng-repeat="rule in shippingMethod.subtotal_config.rules">

                    <ng-form name="subtotal_config_rules">
                        <div class="col-xs-12">
                            <div class="form-group" show-errors>
                                <label for="currency" class="control-label" translate>Currency</label>
                                <select name="currency" class="form-control" ng-model="rule.currency" ng-options="currency.code as currency.name for currency in currencies"></select>
                                <p class="help-block hidden fadeInDown" translate>Please select a currency from the list</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>
                        </div>
                        <div ranges="rule.ranges"></div>
                        <div class="row"></div>

                        <div class="text-right">
                            <span class="delete" ng-click="$parent.confirmDelete(removeRule, 'subtotal_config', rule, $index)">Delete this rule</span>
                        </div>
                        <hr />

                        <div class="row"></div>
                    </ng-form>
                </div>

            </div>
            <!-- End of Subtotal config section -->

            <!-- Quantity config section -->
            <div ng-if="shipping_method_config_type == 'quantity'">
                <div class="col-xs-12">
                    <div class="form-group">
                        <label class="control-label" translate>Prices per quantity</label>
                        <div prices="shippingMethod.quantity_config.prices_per_quantity" currencies="currencies" ></div>
                        <div>
                            <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                        </div>
                    </div>

                </div>
                <div class="col-xs-12">
                    <div class="form-group spacer-b10">
                        <a class="btn btn-primary" ng-click="addNewRule('quantity_config', {prices:[]})" translate>Add a new quantity rule</a>
                    </div>
                </div>

                <div class="col-xs-12">
                    <hr />
                </div>
                <div class="col-xs-12" ng-repeat="rule in shippingMethod.quantity_config.rules">

                    <ng-form name="quantity_config_rules">
                        <div class="col-xs-12 col-md-6">
                            <div class="form-group" show-errors>
                                <label for="minimum" class="control-label" translate>Minimum</label>
                                <input type="tel" class="form-control" name="minimum" ng-model="rule.minimum" required>
                                <p class="help-block hidden fadeInDown" translate>Please provide a minimum value</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="form-group" show-errors>
                                <label for="maximum" class="control-label" translate>Maximum</label>
                                <input type="tel" class="form-control" name="maximum" ng-model="rule.maximum" required>
                                <p class="help-block hidden fadeInDown" translate>Please provide a maximum value</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label class="control-label" translate>Prices</label>
                                <div prices="rule.prices" currencies="currencies"></div>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="row"></div>

                        <div class="text-right">
                            <span class="delete" ng-click="$parent.confirmDelete(removeRule, 'quantity_config', rule, $index)">Delete this rule</span>
                        </div>
                        <hr />

                        <div class="row"></div>
                    </ng-form>
                </div>

            </div>
            <!-- End of Quantity config section -->

            <!-- Weight config section -->
            <div ng-if="shipping_method_config_type == 'weight'">
                <div class="col-xs-12">
                    <div class="form-group" show-errors>
                        <label for="unit" class="control-label" translate>Unit</label>
                        <select name="unit" class="form-control" ng-model="shippingMethod.weight_config.unit" ng-options="unit.code as unit.name for unit in units"></select>
                        <p class="help-block hidden fadeInDown" translate>Please provide a valid unit</p>
                        <div>
                            <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-group">
                        <label class="control-label" translate>Prices per unit</label>
                        <div prices="shippingMethod.weight_config.prices_per_unit" currencies="currencies"></div>
                        <div>
                            <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                        </div>
                    </div>

                </div>
                <div class="col-xs-12">
                    <div class="form-group spacer-b10">
                        <a class="btn btn-primary" ng-click="addNewRule('weight_config', {prices:[]})" translate>Add a new weight rule</a>
                    </div>
                </div>

                <div class="col-xs-12">
                    <hr />
                </div>
                <div class="col-xs-12" ng-repeat="rule in shippingMethod.weight_config.rules">

                    <ng-form name="weight_config_rules">
                        <div class="col-xs-12 col-md-4">
                            <div class="form-group" show-errors>
                                <label for="minimum" class="control-label" translate>Minimum</label>
                                <input type="tel" class="form-control" name="minimum" ng-model="rule.minimum"  required>
                                <p class="help-block hidden fadeInDown" translate>Please provide a minimum value</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 col-md-4">
                            <div class="form-group" show-errors>
                                <label for="maximum" class="control-label" translate>Maximum</label>
                                <input type="tel" class="form-control" name="maximum" ng-model="rule.maximum" required>
                                <p class="help-block hidden fadeInDown" translate>Please provide a maximum value</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 col-md-4">
                            <div class="form-group" show-errors>
                                <label for="unit" class="control-label" translate>Unit</label>
                                <select name="unit" class="form-control" ng-model="rule.unit" ng-options="unit.code as unit.name for unit in units"></select>
                                <p class="help-block hidden fadeInDown" translate>Please provide a valid unit</p>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label class="control-label" translate>Prices</label>
                                <div prices="rule.prices" currencies="currencies"></div>
                                <div>
                                    <p class="help-text" translate>INSERT HELP TEXT HERE</p>
                                </div>
                            </div>

                        </div>
                        <div class="row"></div>

                        <div class="text-right">
                            <span class="delete" ng-click="$parent.confirmDelete(removeRule, 'weight_config', rule, $index)">Delete this rule</span>
                        </div>
                        <hr />

                        <div class="row"></div>
                    </ng-form>
                </div>

            </div>
            <!-- End of Weight config section -->

            <div class="form-group">
                <button ng-if="add" type="submit" class="btn btn-primary btn-right btn-margin-left" ng-click="addShippingMethod()" validate-on-submit translate>Add the Shipping Method</button>
                <button ng-if="update" type="submit" class="btn btn-primary btn-right btn-margin-left" ng-click="updateShippingMethod()" validate-on-submit translate>Save Changes</button>
                <button ng-if="update" type="submit" class="btn btn-default btn-right btn-margin-left" ng-click="confirmCancel()" translate>Cancel</button>
            </div>

            <div class="row"></div>

            <div ng-if="update" class="panel-footer submenu" resource="shipping_methods" method="delete">
                <span class="delete" ng-click="confirmDelete(delete)" translate>Delete this shipping method</span>
            </div>

        </div>
    </form>
</div>