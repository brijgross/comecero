app.service("ApiService",["$http","$q","$rootScope",function(e,a,n){function t(a,n,t,i){null==i&&(i=!0),null==a&&(a=void 0);var r={};r["Content-Type"]="application/json";var o=e({ignoreLoadingBar:!i,method:"post",data:angular.toJson(a),url:n+"?timezone=UTC",params:t,timeout:9e4,isApi:!0,headers:r});return o.then(d,u)}function i(a,n,t,i){null==t&&(t=!0);var r={};i||(i=15e3);var o=e({ignoreLoadingBar:!t,method:"get",url:a,params:n,timeout:i,isApi:!0,headers:r});return n?n.timezone||(o.url+="?timezone=UTC"):o.url+="?timezone=UTC",o.then(d,u)}function r(a,n,t,i){null==t&&(t=!0);var r={};i||(i=25e3),r.Accept="application/pdf";var o=e({ignoreLoadingBar:!t,method:"get",url:a,params:n,timeout:i,isApi:!0,headers:r,responseType:"arraybuffer"});return n?n.timezone||(o.url+="?timezone=UTC"):o.url+="?timezone=UTC",o.then(d,u)}function o(a,n,t){null==t&&(t=!0);var i={},r=utils.getQueryParameters(a);null==r.timezone&&(r.timezone="UTC"),null==r.limit&&(r.limit=50),_.each(n,function(e,a){null!=r[a]&&delete r[a]}),a.indexOf("?")>0&&(a=a.substring(0,a.indexOf("?"))),a=utils.appendParams(a,r);var o=e({ignoreLoadingBar:!t,method:"get",url:a,params:n,timeout:25e3,isApi:!0,headers:i});return o.then(d,u)}function c(a,n,t,i){null==t&&(t=!0);var r={};i&&(token="Bearer "+i);var o=e({ignoreLoadingBar:!t,method:"delete",url:a+"?timezone=UTC",params:n,timeout:15e3,isApi:!0,headers:r});return o.then(d,u)}function s(a,n,t,i,r){null==r&&(r=!0);var o={};o["Content-Type"]=void 0;var c=new FormData;n&&c.append("file",n),Object.keys(a).forEach(function(e,n){c.append(e,a[e])});var s=e({ignoreLoadingBar:!r,method:"post",data:c,transformRequest:angular.identity,url:t+"?timezone=UTC",params:i,timeout:6e5,isApi:!0,isMultipart:!0,headers:o});return s.then(d,u)}function l(e){return"https://"+n.apiHost+"/api/v1"+e}function u(e){var n={};return e.data.error?403==e.data.error.status?(n.code="error",n.message="It appears that you don't have permissions to access page or function you have requested. If you feel this is incorrect, please contact an account administrator.",n.status=e.status,a.reject(n)):a.reject(e.data.error):(n.code="error",n.message=e.statusText,n.status=e.status,a.reject(n))}function d(e){return e.data}return{set:t,getItem:i,getList:o,remove:c,multipartForm:s,buildUrl:l,getItemPdf:r}}]),app.controller("GrowlsCtrl",["$scope","$timeout",function(e,a){e.growls=[],e.$on("event:growl",function(n,t){e.growls.push(t),t.duration>0&&a(function(){e.growls=_.without(e.growls,_.findWhere(e.growls,{id:t.id}))},1e3*t.duration,!0)}),e.clearGrowl=function(a){e.growls=_.without(e.growls,_.findWhere(e.growls,{id:a}))}}]),app.controller("LangCtrl",["$scope","gettextCatalog","ApiService","tmhDynamicLocale",function(e,a,n,t){e.switchLanguage=function(e){"en"!=e&&a.loadRemote("/languages/"+e+"/"+e+".json"),a.setCurrentLanguage(e),localStorage.setItem("language",e),t.set(utils.getLocale(localStorage.getItem("language"))),n.set({language:e},n.buildUrl("/users/me"))}}]),app.directive("isValidPrice",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;if("true"==n.allowEmptyPrice&&(""==t||null==t))return!0;var i=utils.cleanPrice(t);return 0!=utils.isValidNumber(i)&&(!(n.lessThanOrEqual&&parseFloat(i)>parseFloat(n.lessThanOrEqual))&&(!(n.lessThan&&parseFloat(i)>=parseFloat(n.lessThan))&&(!(n.greaterThanOrEqual&&i<n.greaterThanOrEqual)&&!(n.greaterThan&&i<=n.greaterThan))))}}}}),app.directive("isValidInteger",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;return"true"==n.allowEmptyValue&&(""==t||null==t)||0!=utils.isValidInteger(t)&&(!(n.lessThanOrEqual&&Number(t)>Number(n.lessThanOrEqual))&&(!(n.lessThan&&Number(t)>=Number(n.lessThan))&&(!(n.greaterThanOrEqual&&Number(t)<Number(n.greaterThanOrEqual))&&!(n.greaterThan&&Number(t)<=Number(n.greaterThan)))))}}}}),app.directive("isValidNumber",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;return"true"==n.allowEmptyValue&&(""==t||null==t)||0!=utils.isValidNumber(t)&&(!(n.lessThanOrEqual&&Number(t)>Number(n.lessThanOrEqual))&&(!(n.lessThan&&Number(t)>=Number(n.lessThan))&&(!(n.greaterThanOrEqual&&Number(t)<Number(n.greaterThanOrEqual))&&!(n.greaterThan&&Number(t)<=Number(n.greaterThan)))))}}}}),app.directive("isValidUrl",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;return"true"==n.allowEmptyValue&&(""==t||null==t)||/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i.test(t)}}}}),app.directive("isValidEmail",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;return"true"==n.allowEmptyValue&&(""==t||null==t)||/\S+@\S+\.\S+/.test(t)}}}}),app.directive("allowEmpty",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){t.$validators.characters=function(e,a){var t=e||a;return"true"==n.allowEmpty||!utils.isNullOrEmpty(t)}}}}),app.directive("isUsernameAvailable",["$http","$q","ApiService",function(e,a,n){return{restrict:"A",require:"ngModel",link:function(e,t,i,r){r.$validators.invalid_characters=function(e,a){var n=e||a;return/^(?:(?!A-Za-z0-9\-\_\.).)+$/.test(n)},r.$asyncValidators.unavailable=function(e,t){var i=e||t,o=a.defer();if(""==i||null==i||void 0==i)return r.$setValidity("isUsernameAvailable",null),o.resolve(),o.promise;n.getItem(n.buildUrl("/users/"+i),!1).then(function(e){o.reject(e)},function(e){404==e.status?o.resolve(e):(r.validationUnknown=!0,o.resolve())});return o.promise}}}}]),app.directive("cleanPrice",[function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){var i=function(e){if(!angular.isUndefined(e)){var a=utils.cleanPrice(e);return a!==e&&(t.$setViewValue(a),t.$render()),a}};t.$parsers.unshift(i),i(e[n.ngModel])}}}]),app.directive("maxLength",["$timeout",function(e){return{restrict:"A",scope:{item:"=?"},link:function(e,a,n,t){e.$watch("item.$viewValue",function(t){var i="",r=!1,o=!1,c=0;e.item&&e.item.$viewValue&&(c=e.item.$viewValue.length),Number(n.maxLength)-Number(c)>=0?(Number(c)<10?(i=n.maxLength+" characters maximum",r=!1,o=!1):Number(n.maxLength)-Number(c)<20?(i=Number(n.maxLength)-Number(c)+" characters remaining",r=!0,o=!1):(i="About "+10*Math.round((Number(n.maxLength)+4-Number(c))/10)+" characters remaining",r=!1,o=!1),e.item.$setValidity("maxlength",!0)):(i="Whoops! You've entered too many characters.",r=!1,o=!0,e.item.$setValidity("maxlength",!1)),a.removeClass("text-warning text-danger"),1==o&&a.addClass("text-danger"),1==r&&a.addClass("text-warning"),a.text(i)})}}}]),app.directive("sparkline",function(){return{restrict:"A",scope:{data:"=?sparkline",labels:"=?labels",values:"=?values"},link:function(e,a,n){e.$watch("data",function(n){var t={type:"line",width:"100%",height:"50px",fillColor:"",lineColor:"#fff",lineWidth:2,spotColor:"#ffffff",minSpotColor:"#ffffff",maxSpotColor:"#ffffff",highlightSpotColor:"#ffffff",highlightLineColor:"#ffffff",spotRadius:4,highlightLineColor:"#ffffff"};if(e.labels){var i={};_.each(e.labels,function(a,n){i[n]=e.values[n]}),t.tooltipFormat="{{offset:offset}}",t.tooltipValueLookups={offset:i}}a.pixelSparkline(n,t)})}}}),app.directive("sparkbar",function(){return{restrict:"A",scope:{data:"=?sparkbar",labels:"=?labels",values:"=?values"},link:function(e,a,n){e.$watch("data",function(t){var i=10,r=document.getElementById(n.id);if(null!=r&&null!=t){var o=r.offsetWidth;isNaN(o)||(i=parseInt(o/t.length)-2)}i<10&&(i=10),i>40&&(i=40);var c={type:"bar",height:"50px",barColor:"#fff",barSpacing:3,barWidth:i,zeroColor:"#ffffff",negBarColor:"#e66454"};if(e.labels){var s={};_.each(e.labels,function(a,n){s[n]=a+" "+e.values[n]}),c.tooltipFormat="{{offset:offset}}",c.tooltipValueLookups={offset:s}}a.pixelSparkline(t,c)})}}}),app.directive("donut",function(){return{restrict:"A",scope:{data:"=?donut"},link:function(e,a,n){e.$watch("data",function(e){_.each(e,function(e,a){e.color=utils.getColor(a),e.highlight=utils.getRelatedColor(e.color,-.15),e.label=utils.ucaseFirstLetter(e.label)}),toolTip="<%if (label){%><%=label%>: <%}%><%= value %>%",0==n.donutPercentage&&(toolTip="<%if (label){%><%=label%>: <%}%><%= value %>");var a=["easeInQuad","easeInCubic","easeInQuart","easeInQuint","easeInSine","easeInExpo","easeInCirc"],t=(a[Math.floor(Math.random()*a.length)],document.getElementById(n.id).getContext("2d"));new Chart(t).Doughnut(e,{responsive:!0,percentageInnerCutout:60,tooltipTemplate:toolTip,animationEasing:"easeInCubic",animationSteps:50})})}}}),app.directive("login",["$uibModal","authService","SettingsService","$sce","$rootScope",function(e,a,n,t,i){return{restrict:"A",link:function(r,o,c,s){r.$on("event:auth-loginRequired",function(o){if(null==r.openLogin){r.openLogin=e.open({size:"sm",templateUrl:"/login/login.html",backdrop:"static",keyboard:"false"});var c=window.addEventListener?"addEventListener":"attachEvent",s=window[c],l="attachEvent"==c?"onmessage":"message";r.getLoginUrl=function(){return t.trustAsResourceUrl("https://"+i.authHost+"/?iframe=true&msg=true&test="+i.settings.test)},s(l,function(e){var t=e.message?"message":"data",i=e[t];"loginSuccess"==i?(null!=r.openLogin&&(r.openLogin.close(),delete r.openLogin),r.$broadcast("event:loginSuccess"),n.setUserSettings(),a.loginConfirmed()):(r.$broadcast("event:loginFailure"),delete r.openLogin)},!1)}})}}}]),app.directive("selectOnClick",function(){return{restrict:"A",link:function(e,a,n){a.on("click",function(){this.select()})}}}),app.directive("focus",function(){return{restrict:"A",link:function(e,a,n){a[0].focus()}}}),app.directive("resource",function(){return{restrict:"A",link:function(e,a,n){0==utils.hasPermission(n.resource,n.method)&&a[0].remove()}}}),app.directive("dropzone",["ApiService",function(e){return function(a,n,t){var i=t.dropzoneUrl,r=utils.getQueryParameters(i);null==r.timezone&&(r.timezone="UTC"),i.indexOf("?")>0&&(i=i.substring(0,i.indexOf("?"))),i=utils.appendParams(i,r);var o=parseInt(t.dropzoneMaxFiles);isNaN(o)&&(o=1);var c=parseInt(t.dropzoneMaxSize);isNaN(c)&&(c=1e7);var s=!1;null!=t.dropzoneAutoUpload&&"true"==t.dropzoneAutoUpload&&(s=!0);var l=!0;null!=t.dropzoneShowDelete&&"false"==t.dropzoneShowDelete&&(l=!1);var u=t.dropzoneImageUrlName,d=t.dropzoneTemplateId,m=t.dropzoneFiletypes;if(null!=m)var p=m.split(",");var f=document.querySelectorAll(".dropzone-max-size");_.each(f,function(e){e.innerHTML=c/1e6+" MB"}),f=document.querySelectorAll(".dropzone-max-files"),_.each(f,function(e){e.innerHTML=o}),f=document.querySelectorAll(".dropzone-filetypes"),_.each(f,function(e){null!=m&&(e.innerHTML=m.split(",").join(", "))});var d=document.querySelector("#"+d).innerHTML;1==s&&(document.querySelector("#dz-file-upload-button").classList.add("hidden"),document.querySelector("#dz-file-remove-button").classList.add("hidden"));var g=document.querySelector("#dz-preview").innerHTML,h={url:e.buildUrl(i),paramName:t.dropzoneParameterName,dictDefaultMessage:d,previewTemplate:g,headers:{Authorization:"Bearer "+localStorage.getItem("token")},autoProcessQueue:s,uploadMultiple:!1,parallelUploads:4,maxFiles:o,maxFilesize:2e9},v=function(e){var a=document.querySelectorAll(".dz-default");_.each(a,function(e){e.classList.add("hidden")})},A=function(){var e=document.querySelectorAll(".dz-default");e[0].classList.remove("hidden")},S=function(e){e.previewTemplate.querySelector("#dz-file-upload-button").classList.remove("hidden"),e.previewTemplate.querySelector("#dz-file-remove-button").classList.remove("hidden")},y=function(e){e.previewTemplate.querySelector("#dz-file-upload-button").classList.add("hidden"),e.previewTemplate.querySelector("#dz-file-remove-button").classList.add("hidden")},b=function(e){var a=e.previewTemplate.querySelector("#dz-file-upload-progress");a.classList.add("progress-striped"),a.classList.add("active"),a=e.previewTemplate.querySelector("#dz-file-upload-progress-bar"),a.classList.add("progress-bar-info"),a.classList.remove("progress-bar-danger"),a.style.width=0,e.previewTemplate.querySelector("#dz-file-upload-error").classList.add("hidden"),e.previewTemplate.querySelector("#dz-file-upload-error-message").innerHTML=""},P=function(e){b(e),y(e),a.$emit("uploadSending",!0)},w=function(e,n,t){var i=n.previewTemplate.querySelector("#dz-file-upload-progress");i.classList.remove("progress-striped"),i.classList.remove("active"),i=n.previewTemplate.querySelector("#dz-file-upload-progress-bar"),i.classList.remove("progress-bar-info"),i.classList.add("progress-bar-success"),a.$emit("uploadComplete",t),a.$emit("uploadSending",!1),null!=u&&null!=t[u]&&(i=n.previewTemplate.querySelector("#dz-image-preview"),i.src=t[u],i.classList.remove("hidden")),1==l&&(i=n.previewTemplate.querySelector("#dz-file-delete-button"),i.classList.remove("hidden"),i.addEventListener("click",function(e){a.$emit("uploadDelete",t,n)}))},k=function(e,n,t){var i=n.previewTemplate.querySelector("#dz-file-upload-progress");i.classList.remove("progress-striped"),i.classList.remove("active"),i=n.previewTemplate.querySelector("#dz-file-upload-progress-bar"),i.classList.remove("progress-bar-info"),i.classList.add("progress-bar-danger"),a.$emit("uploadSending",!1),n.previewTemplate.querySelector("#dz-file-upload-error").classList.remove("hidden"),t.error&&(n.previewTemplate.querySelector("#dz-file-upload-error-message").innerHTML=t.error.message),S(n),e.options.autoProcessQueue=!1;for(var n,r=0,o=e.files.length;r<o;r++)n=e.files[r],n.status=Dropzone.QUEUED,n.upload.progress=0,n.upload.bytesSent=0,n.upload.total=0},T=function(e){0==e.files.length&&A()},I=function(e,a){if(a.previewTemplate.querySelector("#dz-file-upload-button").classList.remove("hidden"),a.previewTemplate.querySelector("#dz-file-remove-button").classList.remove("hidden"),e.files.length>=o&&v(e),e.files.length>o&&e.removeFile(a),p){var n=a.name.substr(a.name.lastIndexOf(".")+1);p.indexOf(n)==-1&&(a.previewTemplate.querySelector("#dz-file-upload-button").classList.add("hidden"),a.previewTemplate.querySelector("#dz-file-upload-error").classList.remove("hidden"),a.previewTemplate.querySelector("#dz-file-upload-error-message").innerHTML="Invalid file type. Allowed types are: "+p.join(", "))}a.size>c&&(a.previewTemplate.querySelector("#dz-file-upload-button").classList.add("hidden"),a.previewTemplate.querySelector("#dz-file-upload-error").classList.remove("hidden"),a.previewTemplate.querySelector("#dz-file-upload-error-message").innerHTML="File too large. Max size: "+c/1e6+" MB");var t=a.previewTemplate.querySelector("#dz-file-upload-button");t.addEventListener("click",function(){e.getQueuedFiles().length>0?e.processQueue():e.uploadFiles([])})},C=new Dropzone(n[0],h);C.on("sending",function(e,a,n){P(e)}),C.on("success",function(e,a){w(this,e,a)}),C.on("error",function(e,a){k(this,e,a)}),C.on("removedfile",function(e){T(this)}),C.on("addedfile",function(e){I(this,e)});var E=a.$on("uploadCanceled",function(){E(),C.removeAllFiles(!0)});a.$on("uploadDeleted",function(e,a){a.previewTemplate.classList.add("hidden")});a.$watch(t.dropzoneHide,function(e,a){if(e!=a)if(1==e)for(var n=document.querySelectorAll(".dz-default"),t=0;t<n.length;t++)n[t].classList.add("hidden");else for(var n=document.querySelectorAll(".dz-default"),t=0;t<n.length;t++)n[t].classList.remove("hidden")})}}]),app.directive("permissions",["ApiService",function(e){return{restrict:"E",templateUrl:"app/templates/permissions.html",scope:{effectivePermissions:"=?effective",result:"=?"},link:function(a,n,t,i){a.$watch("effectivePermissions",function(e,n){u(a.permissionItems,a.effectivePermissions)},!0),a.checkedItems=[],a.permissionItems=[],a.allow={},a.allow.all=!0;var r=function(){e.getItem(e.buildUrl("/auths/options"),{type:t.authType}).then(function(e){a.permissionItems=e.permissions,a.permissionItems.unshift({resource:"*",methods:["read","create","update","delete"]}),u(a.permissionItems,a.effectivePermissions)})};r();var o=function(e,n){var t=_.findWhere(a.checkedItems,{resource:e});if(null==t){var i={};i.methods=[],i.resource=e,i.methods.push(n),a.checkedItems.push(i)}else t.methods.push(n),t.methods=_.uniq(t.methods)},c=function(e,n){var t=_.findWhere(a.checkedItems,{resource:e});null!=t&&(t.methods=_.without(t.methods,n),"*"!=e&&c("*",n))},s=function(e){_.each(a.permissionItems,function(a){o(a.resource,e)})},l=function(e){_.each(a.permissionItems,function(a){c(a.resource,e)})};a.checkToggle=function(e,n){if(a.isChecked(e,n))c(e,n),"*"==e&&l(n);else if(o(e,n),"*"==e)s(n);else{var t=!0;_.each(a.permissionItems,function(e){e.methods.indexOf(n)>=0&&"*"!=e.resource&&0==a.isChecked(e.resource,n)&&(t=!1)}),1==t&&o("*",n)}a.result=d(a.checkedItems)},a.isChecked=function(e,n){var t=_.findWhere(a.checkedItems,{resource:e});return null!=t&&!(_.indexOf(t.methods,n)<0)};var u=function(e,n){if(null!=n&&null!=e){_.each(e,function(e){utils.hasProperty(n,e.resource)&&_.each(n[e.resource],function(a,n){1==a&&o(e.resource,n)})});var t={};t.read=!0,t.create=!0,t.update=!0,t.delete=!0,_.each(e,function(e){_.each(e.methods,function(n){0==a.isChecked(e.resource,n)&&"*"!=e.resource&&(t[n]=!1)})}),_.each(t,function(e,a){1==e?o("*",a):c("*",a)})}};a.allowsMethod=function(e,n){var t=_.findWhere(a.permissionItems,{resource:e});return null!=t&&_.indexOf(t.methods,n)>=0};var d=function(e){var n=angular.copy(e),t=_.findWhere(n,{resource:"*"});null!=t&&_.each(t.methods,function(e){_.each(n,function(a){"*"!=a.resource&&(a.methods=_.without(a.methods,e))})});var i=[];return _.each(n,function(e){e.methods.length>0&&i.push(e)}),_.each(i,function(e){e.allow=a.allow.all}),0==a.allow.all&&i.push({resource:"*",methods:["*"],allow:!0}),i}}}}]),app.directive("refund",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{payment:"=?",items:"=?",shippingItem:"=?",gatewayAccountId:"=?"},link:function(i,r,o,c){r.hide(),i.$watch("payment.status",function(){i.payment&&("completed"==i.payment.status&&i.payment.total>0?r.show():r.hide())},!0),r.click(function(){i.refund={},i.refund.currency=i.payment.currency,i.refund.disabled=!1,i.refund.reason=null,i.refund.reasons=[],i.refund.show_chargeback=!1,"platform"==i.gatewayAccountId&&"admin."!=localStorage.getItem("token").substring(0,6)||(i.refund.show_chargeback=!0),e.getItem(e.buildUrl("/refunds/options")).then(function(e){i.refund.reasons=e.refund_reasons,i.refund.chargeback_reasons=e.chargeback_reasons},function(e){window.scrollTo(0,0),i.modalError=e}),i.refundTabs=[{active:!0},{active:!1}],i.showItemsTab=!0,i.refund.items=[],_.each(i.items,function(e,a){var e=_.pick(e,"item_id","name","quantity","price","subtotal","tax","total","tax_rate");e.order_quantity=e.quantity,e.quantity=null,i.refund.items.push(e),0==i.refund.items.length&&(i.refundTabs=[{active:!1},{active:!0}],i.showItemsTab=!1)}),i.refund.shipping_item=null,i.shippingItem&&(i.refund.shipping_item=i.shippingItem);var r=t.open({size:"lg",templateUrl:"app/modals/refund.html",scope:i});r.result.then(function(e){i.modalError=null},function(){i.modalError=null}),i.refund.ok=function(e){if(i.modalError=null,!e.$invalid){if(!(0!=utils.sumProperties(i.refund.items,"quantity")||0!=i.refund.shipping_quantity&&i.refund.shipping_quantity||null!=i.refund.total&&0!=parseFloat(i.refund.total)))return void(i.modalError={message:"Please supply an amount or select items to refund."});if(parseFloat(i.refund.getItemsTotal(i.refund.items,i.refund.shipping_quantity))>parseFloat(i.refund.getUnrefundedTotal())||parseFloat(i.refund.total)>parseFloat(i.refund.getUnrefundedTotal()).toFixed(2))return void(i.modalError={message:"The refund amount plus any previous refund amounts cannot be greater than the payment total. The maximum remaining refund for this payment is: "+parseFloat(i.refund.getUnrefundedTotal()).toFixed(2)+" "+i.refund.currency});if(null==i.refund.total&&0==i.refund.getItemTotalQuantities(i.refund.items)&&!i.refund.shipping_quantity)return void(i.modalError={message:"Please indicate what should be refunded"});if(1==i.refund.is_chargeback)var n={id:"process_chargeback"};else var n={id:"process_refund"};n.onConfirm=function(){o(i.refund.items,i.refund.total)},a.showConfirm(i,n)}};var o=function(a,t){i.refund.disabled=!0;var o={};t?o.total=t:(o.items=[],_.each(i.refund.items,function(e){e.quantity&&o.items.push(_.pick(e,"quantity","item_id"))}),1==i.refund.shipping_quantity&&(o.shipping=i.shippingItem.total)),o.reason=i.refund.reason,o.is_chargeback=i.refund.is_chargeback,e.set(o,i.payment.url+"/refunds",{expand:"fees,items"}).then(function(e){i.payment.refunds.data.push(e),utils.roundCurrency(i.refund.getUnrefundedTotal())<=0&&(i.payment.status="refunded"),0==e.is_chargeback?n.addGrowl({id:"refund_success",type:"success",amount:e.total.toFixed(2)+" "+e.currency,url:"/#/refunds/"+e.refund_id}):n.addGrowl({id:"chargeback_success",type:"success",amount:e.total.toFixed(2)+" "+e.currency,url:"/#/refunds/"+e.refund_id}),r.close()},function(a){422==a.status?e.getItem(i.payment_url).then(function(e){i.payment=e,r.close()},function(e){window.scrollTo(0,0),i.modalError=e}):(window.scrollTo(0,0),i.modalError=a)})};i.refund.cancel=function(){r.dismiss()},i.refund.getItemTotal=function(e,a,n){return n?(e*n*(1+a)).toFixed(2):0},i.refund.getShippingTotal=function(e){return e?i.shippingItem.total:0},i.refund.getItemsTotal=function(e,a){var n=0;return _.each(e,function(e){e.quantity&&(n+=Math.round(100*parseFloat(e.price*parseInt(e.quantity)*(1+e.tax_rate)))/100)}),a&&(n+=i.shippingItem.total),n>0?n.toFixed(2):(0).toFixed(2)},i.refund.getItemTotalQuantities=function(e){var a=0;return _.each(e,function(e){e.quantity&&(a+=parseInt(e.quantity))}),a},i.refund.clearTotal=function(){i.refund.total=null},i.refund.clearQuantities=function(){_.each(i.refund.items,function(e){e.quantity=null}),i.refund.shipping_quantity=null},i.refund.getAmountShipping=function(e){if(e==i.payment.total)return i.payment.shipping;var a=e/i.payment.total;return Math.round(i.payment.shipping*a*100)/100},i.refund.getAmountTax=function(e){if(e==i.payment.total)return i.payment.tax;var a=e/i.payment.total;return Math.round(i.payment.tax*a*100)/100},i.refund.getAmountSubtotal=function(e){return e-i.refund.getAmountShipping(e)-i.refund.getAmountTax(e)},i.refund.getAmountTotal=function(e){return null==e?0:e},i.refund.getUnrefundedTotal=function(){var e=_.filter(i.payment.refunds.data,function(e){return _.contains(["completed","pending"],e.status)}),a=utils.sumProperties(e,"total");return utils.roundCurrency(i.payment.total-a)},i.refund.getUnrefundedQuantity=function(e){var a=0,n=_.filter(i.payment.refunds.data,function(e){return _.contains(["completed","pending"],e.status)});return _.each(n,function(n){if(null!=n.items){var t=_.where(n.items,{item_id:e.item_id});_.each(t,function(e){a+=e.quantity})}}),_.find(i.items,{item_id:e.item_id}).quantity-a};var c=!1;_.each(i.items,function(e){if(e.price+e.tax/e.quantity<=parseFloat(i.refund.getUnrefundedTotal())&&i.refund.getUnrefundedQuantity(e)>0)return void(c=!0)}),0==c&&(i.refundTabs=[{active:!1},{active:!0}],i.showItemsTab=!1)})}}}]),app.directive("void",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{payment:"=?",error:"=?"},link:function(t,i,r,o){i.hide(),t.$watch("payment.status",function(){t.payment&&("pending"==t.payment.status&&"credit_card"==t.payment.payment_method.type?i.show():i.hide())},!0),i.click(function(){var i=function(){e.set(null,t.payment.url+"/void").then(function(e){t.payment.status="cancelled",n.addGrowl({id:"void_success",type:"success"})},function(e){422==e.status?t.payment.status="cancelled":(window.scrollTo(0,0),t.error=e)})},r={id:"void_payment"};r.onConfirm=function(){i()},a.showConfirm(t,r)})}}}]),app.directive("capture",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{payment:"=?",items:"=?",shippingItem:"=?"},link:function(i,r,o,c){r.hide(),i.$watch("payment.status",function(){i.payment&&("pending"==i.payment.status&&"credit_card"==i.payment.payment_method.type?r.show():r.hide())},!0),r.click(function(){i.capturePayment={},i.capturePayment.currency=i.payment.currency,i.capturePayment.original_total=i.payment.total,i.capturePayment.original_tax=i.payment.tax,i.capturePayment.original_shipping=i.payment.shipping,i.capturePayment.disabled=!1,i.capturePayment.shipping_quantity=null,i.capturePayment.items=[],i.items&&_.each(i.items,function(e,a){var e=_.pick(e,"order_id","item_id","name","description","quantity","price","subtotal","tax","total","tax_rate");e.order_quantity=e.quantity,e.quantity=null,i.capturePayment.items.push(e)}),i.shippingItem&&(i.capturePayment.shipping_item=i.shippingItem),i.showItemsTab=!0,i.payment.order?i.capturePaymentTabs=[{active:!0},{active:!1}]:(i.capturePaymentTabs=[{active:!1},{active:!0}],i.showItemsTab=!1);var r=t.open({size:"lg",templateUrl:"app/modals/capture_payment.html",scope:i});r.result.then(function(e){i.modalError=null},function(){i.modalError=null}),i.capturePayment.ok=function(e){if(i.modalError=null,!e.$invalid){var n=!1;if(i.capturePayment.getItemTotalQuantities(i.capturePayment.items)>0&&i.capturePayment.getItemTotalQuantities(i.capturePayment.items)<i.capturePayment.getItemTotalQuantities(i.items)&&(n=!0),i.capturePayment.shipping_quantity&&0==i.capturePayment.getItemTotalQuantities(i.capturePayment.items)&&(n=!0),i.capturePayment.shipping_quantity||!i.shippingItem||i.capturePayment.total||(n=!0),i.capturePayment.total&&parseFloat(i.capturePayment.total)<i.payment.total&&(n=!0),null==i.capturePayment.total&&0==i.capturePayment.getItemTotalQuantities(i.capturePayment.items)&&!i.capturePayment.shipping_quantity)return void(i.modalError={message:"Please indicate what should be captured"});if(n){var t={id:"partial_capture_warning"};t.onConfirm=function(){o(i.capturePayment.items,i.capturePayment.total)},a.showConfirm(i,t)}else o(i.capturePayment.items,i.capturePayment.total)}};var o=function(a,t){i.capturePayment.disabled=!0;var o={};t?o.total=t:(o.items=[],_.each(i.capturePayment.items,function(e){e.quantity&&o.items.push(_.pick(e,"quantity","item_id"))}),1==i.capturePayment.shipping_quantity&&(o.shipping=i.shippingItem.total));var c={expand:"customer,response_data,items.shipments,gateway,fees,commissions,order,refunds,payment_method"};e.set(o,i.payment.url+"/capture",c).then(function(e){i.payment=e,n.addGrowl({id:"payment_capture_success",type:"success"}),r.close(e)},function(a){422==a.status?e.getItem(i.payment.url).then(function(e){r.close(e)},function(){r.close(a)}):(window.scrollTo(0,0),i.modalError=a)})};i.capturePayment.cancel=function(){r.dismiss()},i.capturePayment.getItemTotal=function(e,a,n){return n?(e*n*(1+a)).toFixed(2):0},i.capturePayment.getShippingTotal=function(e){return e?i.shippingItem.total:0},i.capturePayment.getItemsTotal=function(e,a){var n=0;return _.each(e,function(e){e.quantity&&(n+=Math.round(100*parseFloat(e.price*parseInt(e.quantity)*(1+e.tax_rate)))/100)}),a&&(n+=i.shippingItem.total),n>0?n.toFixed(2):(0).toFixed(2)},i.capturePayment.getItemTotalQuantities=function(e){var a=0;return null!=e&&_.each(e,function(e){e.quantity&&(a+=parseInt(e.quantity))}),a},i.capturePayment.clearTotal=function(){i.capturePayment.total=null},i.capturePayment.clearQuantities=function(){_.each(i.capturePayment.items,function(e){e.quantity=null})},i.capturePayment.getAmountShipping=function(e){if(e==i.capturePayment.original_total)return i.capturePayment.original_shipping;var a=e/i.capturePayment.original_total;return Math.round(i.capturePayment.original_shipping*a*100)/100},i.capturePayment.getAmountTax=function(e){if(e==i.capturePayment.original_total)return i.capturePayment.original_tax;var a=e/i.capturePayment.original_total;return Math.round(i.capturePayment.original_tax*a*100)/100},i.capturePayment.getAmountSubtotal=function(e){return e-i.capturePayment.getAmountShipping(e)-i.capturePayment.getAmountTax(e)},i.capturePayment.getAmountTotal=function(e){return null==e?0:e},i.loadTotal=function(e){return utils.cleanPrice(e)}})}}}]),app.directive("ship",["ApiService","ConfirmService","GrowlsService","CouriersService","$uibModal","$q",function(e,a,n,t,r,o){return{restrict:"A",scope:{order:"=?"},link:function(a,o,c,s){o.hide(),a.$watch("order.fulfilled",function(){a.order&&(0==a.order.fulfilled?o.show():o.hide())},!0),o.click(function(){a.shipItems={},a.shipItems.disabled=!1,a.shipItems.isFulfilled=function(e){return 0==e.shippableQuantity},a.shipItems.getShippableQuantity=function(e){var n=0;return _.each(a.order.shipments.data,function(a){var t=_.filter(a.items,function(a){return a.item_id==e.item_id});_.each(t,function(e){n+=e.quantity})}),e.quantity-n==0&&(e.fulfilled=!0),e.quantity-n},a.shipItems.shipments=[],_.each(a.order.items,function(e,n){if(0==e.fulfilled){var t=_.pick(e,"order_id","item_id","name","quantity");t.order_quantity=t.quantity,t.quantity=null,t.shippableQuantity=a.shipItems.getShippableQuantity(e),a.shipItems.shipments.push(t)}}),a.shipItems.dates=[];var o=utils.addDays(new Date(a.order.date_created),-1).setHours(0,0,0,0);for(i=1;i<utils.daysDiff(o,utils.addDays(new Date,5))&&(a.shipItems.dates.push(utils.addDays(new Date(o),i).setHours(0,0,0,0)),30!=i);i++);a.shipItems.date_shipped=(new Date).setHours(0,0,0,0),a.shipItems.courier=null,a.shipItems.couriers=t.getCouriers();var c=r.open({size:"lg",templateUrl:"app/modals/ship_items.html",scope:a});c.result.then(function(e){a.modalError=null},function(){a.modalError=null}),a.shipItems.ok=function(t){if(a.modalError=null,!t.$invalid){a.shipItems.disabled=!1;var i={};i.tracking_number=a.shipItems.tracking_number,i.tracking_url=a.shipItems.tracking_url,i.date_shipped=new Date(a.shipItems.date_shipped+60*new Date(a.shipItems.date_shipped).getTimezoneOffset()).toISOString(),0==utils.isNullOrEmpty(a.shipItems.courier)&&(i.courier=a.shipItems.courier),i.items=[];var r=0;_.each(a.shipItems.shipments,function(e,a){e.quantity&&0!=e.quantity&&(i.items.push(e),r++)}),e.set(i,e.buildUrl("/orders/"+a.order.order_id+"/shipments")).then(function(e){n.addGrowl({id:"shipment_success",count:r}),a.order.shipments.data.push(e);var t=0;_.each(a.order.items,function(e){0==e.fulfilled&&(t+=a.shipItems.getShippableQuantity(e))}),0==t&&(a.order.fulfilled=!0),c.close()},function(e){a.modalError=e})}},a.shipItems.cancel=function(){c.dismiss()}})}}}]),app.directive("cancelSubscription",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{subscription:"=?"},link:function(i,r,o,c){r.hide(),i.$watch("subscription",function(){i.subscription&&("active"!=i.subscription.status&&"trial"!=i.subscription.status||0!=i.subscription.cancel_at_current_period_end?r.hide():r.show())},!0),r.click(function(){i.subscription_cancel={},i.subscription_cancel.request={},i.subscription_cancel.request.cancel_at_current_period_end=!0,i.subscription_cancel.request.cancellation_reason=null,i.cancellation_reasons=[],e.getItem(e.buildUrl("/subscriptions/options")).then(function(e){i.cancellation_reasons=e.cancellation_reasons},function(e){window.scrollTo(0,0),i.modalError=e});var r=t.open({size:"lg",templateUrl:"app/modals/cancel_subscription.html",scope:i});r.result.then(function(e){i.modalError=null},function(){i.modalError=null}),i.subscription_cancel.ok=function(e){i.modalError=null;var n={id:"cancel_subscription"};n.onConfirm=function(){o()},a.showConfirm(i,n)};var o=function(){var a={};1==i.subscription_cancel.request.cancel_at_current_period_end?a.cancel_at_current_period_end=!0:a.status="cancelled",
e.set(a,i.subscription.url,{expand:"subscription_plan,customer,product"}).then(function(e){i.subscription=e,r.dismiss(),n.addGrowl({id:"subscription_cancel_success",type:"success"})},function(e){window.scrollTo(0,0),i.modalError=e})};i.subscription_cancel.cancel=function(){r.dismiss()}})}}}]),app.directive("objectList",["ApiService","$location",function(e,a){return{restrict:"A",templateUrl:function(e,a){return a.templateUrl},scope:{error:"=?",count:"=?",refreshOnChange:"=?",functions:"=?",refresh:"=?",meta:"=?",params:"=?"},link:function(n,t,i,r){n.list={},n.userParams={},n.settings={};var o=null,c=n.params||{};n.params||("order"==i.type&&(c.show="date_created,order_id,fulfilled,total,payment_status,currency",o="date_created"),"subscription"==i.type&&(c.show="subscription_id,subscription_plan.name,reference_price,reference_currency,status,item.name,item.product.product_id,date_modified,in_grace_period;",c.expand="subscription_plan,item.product",o="date_modified"),"payment"==i.type&&(c.show="payment_id,date_created,date_modified,status,success,total,currency",o="date_created"),"refund"==i.type&&(c.show="refund_id,date_created,date_modified,status,success,total,currency",o="date_created"),"shipment"==i.type&&(c.show="shipment_id,courier,tracking_url,tracking_number,date_shipped,items.name,items.quantity",o="date_shipped"),"cart"==i.type&&(c.show="cart_id,date_created,payment_status,total,date_modified,currency",o="date_modified"),"invoice"==i.type&&(c.show="invoice_id,date_created,date_due,payment_status,total,date_modified,currency",o="date_modified"),"app"==i.type&&(c.show="name,app_id,date_created,active,deleted,date_modified,images.link_square,installed,install_url,app_installation.launch_url,app_installation.app_installation_id",c.expand="images,app_installation",o="date_created"),"app_installation"==i.type&&(c.show="name,app_installation_id,date_created,image_url,short_description,info_url,launch_url,settings_fields,style_fields,version,is_default_version,updated_version_available,install_url,platform_hosted",c.expand="images",o="name",n.userParams.desc=!1),"notification"==i.type&&(c.show="notification_id,date_created,type,status",c.limit=25,o="date_created")),utils.stringsToBool(i),n.settings.page=i.page,n.settings.search=!0,0==i.search&&(n.settings.search=!1);var s=function(){p(),n.userParams=a.search(),utils.stringsToBool(n.userParams),m()},l=function(a){var t=utils.appendParams(i.url,c);e.getList(t,n.userParams).then(function(e){n.list=e,n.count=e.total_items,1==a&0==i.embedded&&window.scrollTo(0,0),d(n.list)},function(e){n.error=e})},u=function(e){l(e)};n.refresh=function(){u()};var d=function(e){n.userParams.before_item=e.previous_page_before_item,n.userParams.after_item=e.previous_page_before_item,n.previous_page_offset=e.previous_page_offset,n.next_page_offset=e.next_page_offset},m=function(){"cursor"==n.settings.page?null==n.userParams.date_type&&(n.userParams.date_type=o):null==n.userParams.sort_by&&(n.userParams.sort_by=o),null==n.userParams.desc&&(n.userParams.desc=!0),null!=i.limit&&(n.userParams.limit=i.limit)},p=function(){n.userParams={}},f=function(){n.userParams.before_item=null,n.userParams.after_item=null,n.previous_page_offset=null,n.next_page_offset=null};if(n.movePage=function(e,t){"cursor"==n.settings.page?"+"==e?(n.userParams.after_item=t,n.userParams.before_item=null):(n.userParams.after_item=null,n.userParams.before_item=t):n.userParams.offset=t,0==i.embedded?a.search(n.userParams):u(!1)},n.setParam=function(e,t){p(),n.userParams[e]=t,m(),0==i.embedded?a.search(n.userParams):u(!1)},n.search=function(e){f(),n.userParams.q=e,m(),0==i.embedded?a.search(n.userParams):u(!1)},n.sort=function(e,t){"cursor"==n.settings.page?(n.userParams.date_type=e,n.userParams.before_item&&(n.userParams.after_item=n.userParams.before_item,n.userParams.before_item=null),n.userParams.after_item&&(n.userParams.before_item=n.userParams.after_item,n.userParams.after_item=null)):(n.userParams.sort_by=e,n.userParams.offset=null),n.userParams.desc=t,0==i.embedded?a.search(n.userParams):u()},n.getSortValue=function(){return"cursor"==n.settings.page?n.userParams.date_type:n.userParams.sort_by},0==i.embedded)var g=n.$on("$routeUpdate",function(e){s(),l(!0)});n.$on("$destroy",function(){g&&g()}),s(),m(),l(!0);var h=null;n.$watchCollection("refreshOnChange",function(){null!=n.refreshOnChange&&Array.isArray(n.refreshOnChange)&&null==h&&(h=n.refreshOnChange.length),null!=h&&Array.isArray(n.refreshOnChange)&&h!=n.refreshOnChange.length&&(u(),h=n.refreshOnChange.length)})}}}]),app.directive("objectEdit",["ApiService","GrowlsService","GeographiesService",function(e,a,n){return{restrict:"E",templateUrl:function(e,a){return a.templateUrl},scope:{object:"=?",error:"=?",options:"=?",successCallback:"&"},link:function(t,i,r,o){t.item=null,utils.stringsToBool(r),t.displayCount=0,t.edit=!1,t.allowEdit=!0,0==r.allowEdit&&(t.allowEdit=!1),t.panelTitle=r.panelTitle;var c=null;0==utils.isNullOrEmpty(r.property)&&(c=r.property),t.$watch("object",function(){t.item=t.object});var s=[];null!=r.hide&&(s=r.hide.split(","));var l=[];null!=r.require&&(l=r.require.split(","));var u=n.getGeographies();t.countries=u.countries,t.showItem=function(e){return!(s.indexOf(e)>=0)},t.allowEmpty=function(e){return!(l.indexOf(e)>=0&&s.indexOf(e)<0)},t.openEdit=function(){t.orig=angular.copy(t.item),t.edit=!0},t.closeEdit=function(){t.item=t.orig,t.edit=!1},t.update=function(n){if(!n.$invalid){var i={};c?i[c]=t.item:i=t.item,e.set(i,r.updateUrl,{show:c}).then(function(e){c?t.object[c]=e[c]:t.object=e,a.addGrowl({id:"edit_success_no_link",type:"success"}),t.edit=!1,t.successCallback()},function(e){window.scrollTo(0,0),t.error=e})}}}}}]),app.directive("ledgerBreakdown",[function(){return{restrict:"E",templateUrl:"app/templates/ledgerBreakdown.html",scope:{currencyType:"=?",transactions:"=?",loadDetails:"=?",detailsUrl:"=?"},link:function(e,a,n,t){e.transactionItems=[],e.selected={},e.panelTitle=n.panelTitle,null==e.currencyType&&(e.currencyType="transaction"),e.toggleLoadDetails=function(){e.loadDetails=!e.loadDetails},e.load=function(a){if(e.transactionItems=[],Array.isArray(e.transactions)?e.transactionItems=e.transactions:utils.hasProperty(e.transactions,"object")&&e.transactionItems.push(e.transactions),e.selected.subtotal=0,e.selected.shipping=0,e.selected.tax=0,e.selected.total=0,e.currencyType=a,e.transactionItems.length>0){var t=a+"_";"transaction"==a&&(t=""),"refund"==e.transactionItems[0].object&&(e.isRefund=!0),e.transaction_currency=e.transactionItems[0].currency,e.settlement_currency=e.transactionItems[0].settlement_currency,e.reporting_currency=e.transactionItems[0].reporting_currency,e.reporting_alt_currency=e.transactionItems[0].reporting_alt_currency,e.selected.currency=e.transactionItems[0][t+"currency"],_.each(e.transactionItems,function(a){var i=!0;null!=n.includeStatus&&n.includeStatus.indexOf(a.status)==-1&&(i=!1),i&&(e.selected.subtotal=e.selected.subtotal+parseFloat(a[t+"subtotal"]),e.selected.shipping=e.selected.shipping+parseFloat(a[t+"shipping"]),e.selected.tax=e.selected.tax+parseFloat(a[t+"tax"]),e.selected.total=e.selected.total+parseFloat(a[t+"total"]))}),"refund"==e.transactionItems[0].object&&(e.selected.subtotal=e.selected.subtotal*-1,e.selected.shipping=e.selected.shipping*-1,e.selected.tax=e.selected.tax*-1,e.selected.total=e.selected.total*-1)}},e.showCurrencies=function(){return e.transactionItems.length>0&&(e.transactionItems[0].reporting_alt_currency?!utils.areEqual(e.transactionItems[0].currency,e.transactionItems[0].settlement_currency,e.transactionItems[0].reporting_currency,e.transactionItems[0].reporting_alt_currency):!utils.areEqual(e.transactionItems[0].currency,e.transactionItems[0].settlement_currency,e.transactionItems[0].reporting_currency))},e.$watchCollection("transactions",function(){e.load(e.currencyType)}),e.$watch("currencyType",function(){e.load(e.currencyType)})}}}]),app.directive("ledgerItems",[function(){return{restrict:"E",templateUrl:"app/templates/ledgerItems.html",scope:{items:"=?"},link:function(e,a,n,t){e.panelTitle=n.panelTitle,e.total=0,e.noItemsMessage=n.noItemsMessage,e.$watchCollection("items",function(){if(e.items&&e.items.length>0)for(e.currency=e.items[0].currency,i=0;i<e.items.length;i++)e.items[i].description=e.items[i][n.descriptionProperty],e.total+=e.items[i].total})}}}]),app.directive("paymentMethod",[function(){return{restrict:"E",templateUrl:"app/templates/paymentMethod.html",scope:{paymentMethodData:"=?"},link:function(e,a,n,t){e.panelTitle=n.panelTitle,e.transaction_type=n.transactionType,e.$watch("paymentMethodData",function(){e.paymentMethodData&&(e.transaction_id=n.transactionId)}),e.showItem=function(e){return!(hide.indexOf(e)>=0)}}}}]),app.directive("ledgerSale",[function(){return{restrict:"E",templateUrl:"app/templates/sale.html",scope:{sale:"=?"},link:function(e,a,n,t){e.prefs={},e.prefs.currency="transaction"}}}]),app.directive("fileSelect",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{file:"=?",error:"=?"},link:function(n,i,r,o){i.click(function(){n.fileSelect={file:{}},n.fileSelect.params={},n.fileSelect.params.show="file_id,name,filename,version,bytes,description,date_created,date_modified",n.fileSelect.params.limit=5,n.fileSelect.params.sort_by="name",n.fileSelect.params.desc=!1,n.options={by_url:!1};var i=function(a){e.getList(a,n.fileSelect.params).then(function(e){n.fileList=e},function(e){n.modalError=e})};n.uploadByUrl=function(){var a=angular.copy(n.fileSelect.file);a.url=n.options.url,a.http_authorization_username=n.options.http_authorization_username,a.http_authorization_password=n.options.http_authorization_password,e.multipartForm(a,null,e.buildUrl("/files")).then(function(e){l.close(e)},function(e){n.modalError=e})};var r=!1,o=n.$on("uploadSending",function(e,a){r=a}),c=n.$on("uploadComplete",function(e,a){l.close(a)}),s=function(){c(),o()};i(e.buildUrl("/files")),utils.hasPermission("files","create")?n.fileSelectTabs=[{active:!0},{active:!1}]:n.fileSelectTabs=[{active:!1},{active:!0}];var l=t.open({size:"lg",templateUrl:"app/modals/file_select.html",scope:n,backdrop:"static"});l.result.then(function(e){s(),n.file=e,n.modalError=null},function(){s(),n.modalError=null}),n.fileSelect.ok=function(e){l.close(e)},n.fileSelect.cancel=function(){if(r){var e={id:"upload_cancel"};e.onConfirm=function(){n.$broadcast("uploadCanceled"),l.dismiss()},a.showConfirm(n,e)}else l.dismiss()},n.fileSelect.search=function(){n.fileSelect.params.q=n.fileSelect.q,i(e.buildUrl("/files"))},n.fileSelect.sort=function(a,t){n.fileSelect.params.sort_by=a,n.fileSelect.params.desc=t,i(e.buildUrl("/files"))},n.fileSelect.movePage=function(e){i("+"==e?n.fileList.next_page_url:n.fileList.previous_page_url)}})}}}]),app.directive("subscriptionPlanSelect",["ApiService","ConfirmService","GrowlsService","$uibModal","$rootScope",function(e,a,n,t,i){return{restrict:"A",scope:{subscriptionPlan:"=?",error:"=?"},link:function(a,n,r,o){n.click(function(){a.subscriptionPlanSelect={},a.subscriptionPlanSelect.params={},a.subscriptionPlanSelect.params.show="subscription_plan_id,name,billing_interval,billing_interval_unit,trial_interval,trial_interval_unit,description,date_created,end_at_billing_count,date_modified",a.subscriptionPlanSelect.params.limit=5,a.subscriptionPlanSelect.params.sort_by="name",a.subscriptionPlanSelect.params.desc=!1,a.subscriptionPlanSelect.order_confirmation_on_renewal=!0,a.subscriptionPlanSelect.fulfill_on_renewal=!0,a.subscription_plan={},a.subscription_plan.fulfill_on_renewal=!1,a.subscription_plan.order_confirmation_on_renewal=!0,a.settings=i.settings;var n=function(n){e.getList(n,a.subscriptionPlanSelect.params).then(function(e){a.subscriptionPlanList=e},function(e){a.modalError=e})};n(e.buildUrl("/subscription_plans")),utils.hasPermission("subscription_plans","create")?a.subscriptionPlanSelectTabs=[{active:!0},{active:!1}]:a.subscriptionPlanSelectTabs=[{active:!1},{active:!0}];var r=t.open({size:"lg",templateUrl:"app/modals/subscription_plan_select.html",scope:a});r.result.then(function(e){a.subscriptionPlan=e,a.modalError=null},function(){a.modalError=null}),a.subscriptionPlanSelect.ok=function(e){r.close(e)},a.subscriptionPlanSelect.cancel=function(){r.dismiss()},a.subscriptionPlanSelect.search=function(){a.subscriptionPlanSelect.params.q=a.subscriptionPlanSelect.q,n(e.buildUrl("/subscription_plans"))},a.subscriptionPlanSelect.sort=function(t,i){a.subscriptionPlanSelect.params.sort_by=t,a.subscriptionPlanSelect.params.desc=i,n(e.buildUrl("/subscription_plans"))},a.subscriptionPlanSelect.setParam=function(t,i){a.subscriptionPlanSelect.params[t]=i,n(e.buildUrl("/subscription_plans"))},a.subscriptionPlanSelect.create=function(n){n.$invalid||e.set(a.subscription_plan,e.buildUrl("/subscription_plans")).then(function(e){r.close(e)},function(e){a.modalError=e})},a.subscriptionPlanSelect.movePage=function(e){n("+"==e?a.subscriptionPlanList.next_page_url:a.subscriptionPlanList.previous_page_url)}})}}}]),app.directive("templateSelect",["ApiService","ConfirmService","GrowlsService","$uibModal","$rootScope",function(e,a,n,t,i){return{restrict:"A",scope:{template:"=?",error:"=?"},link:function(a,n,r,o){n.click(function(){a.templateSelect={},a.templateSelect.params={},a.templateSelect.params.show="template_id,comments,date_created,date_modified",a.templateSelect.params.limit=5,a.templateSelect.params.sort_by="name",a.templateSelect.params.desc=!1,a.template={},a.settings=i.settings;var n=function(n){e.getList(n,a.templateSelect.params).then(function(e){a.templateList=e},function(e){a.modalError=e})};n(e.buildUrl("/templates")),utils.hasPermission("templates","create")?a.templateSelectTabs=[{active:!0},{active:!1}]:a.templateSelectTabs=[{active:!1},{active:!0}];var r=t.open({size:"lg",templateUrl:"app/modals/template_select.html",scope:a});r.result.then(function(e){a.template=e,a.modalError=null},function(){a.modalError=null}),a.templateSelect.ok=function(e){r.close(e)},a.templateSelect.cancel=function(){r.dismiss()},a.templateSelect.search=function(){a.templateSelect.params.q=a.templateSelect.q,n(e.buildUrl("/templates"))},a.templateSelect.sort=function(t,i){a.templateSelect.params.sort_by=t,a.templateSelect.params.desc=i,n(e.buildUrl("/templates"))},a.templateSelect.setParam=function(t,i){a.templateSelect.params[t]=i,n(e.buildUrl("/templates"))},a.templateSelect.create=function(n){n.$invalid||e.set(a.template,e.buildUrl("/templates")).then(function(e){r.close(e)},function(e){a.modalError=e})},a.templateSelect.movePage=function(e){n("+"==e?a.templateList.next_page_url:a.templateList.previous_page_url)}})}}}]),app.directive("imagesSelect",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{images:"=?",error:"=?"},link:function(n,i,r,o){i.click(function(){n.imagesSelect={},n.imagesSelect.limit=r.limit||15,n.imagesSelect.params={},n.imagesSelect.params.show="image_id,filename,reference,link_large,link_medium,link_small,link_square,link,date_created,date_modified",n.imagesSelect.params.limit=5,n.imagesSelect.params.sort_by="filename",n.imagesSelect.params.desc=!1;var i=function(a){e.getList(a,n.imagesSelect.params).then(function(e){n.imageList=e},function(e){n.modalError=e})},o=!1,c=n.$on("uploadSending",function(e,a){o=a}),s=n.$on("uploadComplete",function(e,a){n.$apply(function(){n.imagesSelect.queueImage(a)})}),l=n.$on("uploadDelete",function(t,i,r){var o={id:"delete"};o.onConfirm=function(){n.$broadcast("uploadDeleted",r),n.imagesSelect.dequeueImage(i),utils.hasPermission("images","delete")&&e.remove(i.url,null,!1)},a.showConfirm(n,o)}),u=function(){s(),c(),l()};i(e.buildUrl("/images")),utils.hasPermission("images","create")?n.imagesSelectTabs=[{active:!0},{active:!1}]:n.imagesSelectTabs=[{active:!1},{active:!0}];var d=t.open({size:"lg",templateUrl:"app/modals/image_select.html",scope:n,backdrop:"static"});d.result.then(function(){u(),n.images=n.imagesSelect.queue,n.modalError=null},function(){u(),n.modalError=null}),n.imagesSelect.queue=[],n.imagesSelect.queueToggle=function(e){n.imagesSelect.isQueued(e)?n.imagesSelect.dequeueImage(e):n.imagesSelect.queueImage(e)},n.imagesSelect.queueImage=function(e){n.imagesSelect.queue.length>=n.imagesSelect.limit&&n.imagesSelect.queue.shift(),n.imagesSelect.queue.push(e)},n.imagesSelect.dequeueImage=function(e){n.imagesSelect.queue=_.reject(n.imagesSelect.queue,{image_id:e.image_id})},n.imagesSelect.isQueued=function(e){return null!=_.findWhere(n.imagesSelect.queue,{image_id:e.image_id})},_.each(n.images,function(e){n.imagesSelect.queueImage(e)}),n.imagesSelect.ok=function(e){d.close(e)},n.imagesSelect.cancel=function(){if(o){var e={id:"upload_cancel"};e.onConfirm=function(){n.$broadcast("uploadCanceled"),d.dismiss()},a.showConfirm(n,e)}else d.dismiss()},n.imagesSelect.search=function(){n.imagesSelect.params.q=n.imagesSelect.q,i(e.buildUrl("/images"))},n.imagesSelect.sort=function(a,t){n.imagesSelect.params.sort_by=a,n.imagesSelect.params.desc=t,i(e.buildUrl("/images"))},n.imagesSelect.movePage=function(e){i("+"==e?n.imageList.next_page_url:n.imageList.previous_page_url)}})}}}]),app.directive("licenseServiceSelect",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{licenseService:"=?",error:"=?"},link:function(a,n,i,r){n.click(function(){a.licenseServiceSelect={},a.licenseServiceSelect.params={},a.licenseServiceSelect.params.show="license_service_id,name,type,configuration.license_count,configuration.notify_at_count,configuration.url,date_created,date_modified",a.licenseServiceSelect.params.limit=5,a.licenseServiceSelect.params.sort_by="name",a.licenseServiceSelect.params.desc=!1,a.licenseServiceSelect.type="list",a.licenses={},a.license_service={},a.license_service.type="list",a.license_service.configuration={},a.license_service.configuration.format="json",a.license_service.configuration.per_quantity=!1,a.license_service.configuration.remove_after_use=!0,a.license_service.configuration.notify_at_count=100;var n=function(n){e.getList(n,a.licenseServiceSelect.params).then(function(e){a.licenseServiceList=e},function(e){a.modalError=e})};n(e.buildUrl("/license_services")),utils.hasPermission("license_services","create")?a.licenseServiceSelectTabs=[{active:!0},{active:!1}]:a.licenseServiceSelectTabs=[{active:!1},{active:!0}];var i=t.open({size:"lg",templateUrl:"app/modals/license_service_select.html",scope:a});i.result.then(function(e){a.licenseService=e,a.modalError=null},function(){a.modalError=null}),a.licenseServiceSelect.ok=function(e){i.close(e)},a.licenseServiceSelect.cancel=function(){i.dismiss()},a.licenseServiceSelect.search=function(){a.licenseServiceSelect.params.q=a.licenseServiceSelect.q,n(e.buildUrl("/license_services"))},a.licenseServiceSelect.sort=function(t,i){a.licenseServiceSelect.params.sort_by=t,a.licenseServiceSelect.params.desc=i,n(e.buildUrl("/license_services"))},a.licenseServiceSelect.setParam=function(t,i){a.licenseServiceSelect.params[t]=i,n(e.buildUrl("/license_services"))},a.licenseServiceSelect.create=function(n){n.$invalid||(null!=a.licenses.list&&"list"==a.licenseServiceSelect.type&&(a.license_service.configuration.licenses=utils.stringToArray(a.licenses.list)),e.set(a.license_service,e.buildUrl("/license_services")).then(function(e){i.close(e)},function(e){a.modalError=e}))},a.licenseServiceSelect.movePage=function(e){n("+"==e?a.licenseServiceList.next_page_url:a.licenseServiceList.previous_page_url)}})}}}]),app.directive("imageGroup",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"E",templateUrl:"app/templates/image_group.html",scope:{images:"=?"},link:function(e,a,n,t){e.showMoreSizesList=[],e.limit=n.limit||15,e.toggleMoreSizes=function(a){e.showMoreSizesList.indexOf(a)==-1?e.showMoreSizesList.push(a):e.showMoreSizesList=_.without(e.showMoreSizesList,a)},e.showMoreSizes=function(a){return e.showMoreSizesList.indexOf(a)>=0},e.removeAll=function(){e.images=null}}}}]),app.directive("fields",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"AE",templateUrl:"app/templates/fields.html",scope:{fieldlist:"=?",selections:"=?",error:"="},link:function(a,n,t,i){a.data={images:{}},a.data.imagePreviews=[],a.$watch("fieldlist",function(n,t){if(n!==t){for(var i in a.fieldlist)a.fieldlist.hasOwnProperty(i)&&null==a.selections[a.fieldlist[i].name]&&(a.selections[a.fieldlist[i].name]=a.fieldlist[i].default_value),"image"==a.fieldlist[i].type&&null!=a.selections[a.fieldlist[i].name]&&a.data.imagePreviews.push({property:a.fieldlist[i].name,url:e.buildUrl("/images/"+a.selections[a.fieldlist[i].name])});utils.hasPermission("images","read")&&_.each(a.data.imagePreviews,function(n){e.getItem(n.url).then(function(e){(a.data.images[n.property]=[]).push(e)},function(e){a.error&&(a.error=e,window.scrollTo(0,0))})})}},!0),a.$watch("data.images",function(e,n){if(e!==n)for(var t in e)e.hasOwnProperty(t)&&(null!=e[t]?a.selections[t]=e[t][0].image_id:a.selections[t]=null)},!0),a.pushToProperty=function(e,n){e=r(e),0==a.isInProperty(e,n)?null==a.selections[e]?(a.selections[e]=[],a.selections[e].push(n)):a.selections[e].push(n):a.selections[e]=_.without(a.selections[e],n)},a.isInProperty=function(e,n){return e=r(e),null!=a.selections&&(null!=a.selections[e]&&_.indexOf(a.selections[e],n)>=0)},a.isNewSection=function(e,n){if(0==n)return!0;var t=a.fieldlist[n-1];return null!=t&&t.section!=e.section};var r=function(e){null!=e&&"-search"==utils.right(e,7)&&(e=utils.left(e,e.length-7))}}}}]),app.directive("appPackageSelect",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{appPackage:"=?",error:"=?"},link:function(n,i,r,o){i.click(function(){n.appPackageSelect={},n.appPackageSelect.params={},n.appPackageSelect.params.show="app_package_id,name,filename,version,bytes,description,date_created,date_modified",n.appPackageSelect.params.limit=5,n.appPackageSelect.params.sort_by="name",n.appPackageSelect.params.desc=!1;var i=function(a){e.getList(a,n.appPackageSelect.params).then(function(e){n.appPackageList=e},function(e){n.modalError=e})},r=!1,o=n.$on("uploadSending",function(e,a){r=a}),c=n.$on("uploadComplete",function(e,a){l.close(a)}),s=function(){c(),o()};i(e.buildUrl("/app_packages")),utils.hasPermission("app_packages","create")?n.appPackageSelectTabs=[{active:!0},{active:!1}]:n.appPackageSelectTabs=[{active:!1},{active:!0}];var l=t.open({size:"lg",templateUrl:"app/modals/app_package_select.html",scope:n,backdrop:"static"});l.result.then(function(e){s(),n.appPackage=e,n.modalError=null},function(){s(),n.modalError=null}),n.appPackageSelect.ok=function(e){l.close(e)},n.appPackageSelect.cancel=function(){if(r){var e={id:"upload_cancel"};e.onConfirm=function(){n.$broadcast("uploadCanceled"),l.dismiss()},a.showConfirm(n,e)}else l.dismiss()},n.appPackageSelect.search=function(){n.appPackageSelect.params.q=n.appPackageSelect.q,i(e.buildUrl("/app_packages"))},n.appPackageSelect.sort=function(a,t){n.appPackageSelect.params.sort_by=a,n.appPackageSelect.params.desc=t,i(e.buildUrl("/app_packages"))},n.appPackageSelect.movePage=function(e){i("+"==e?n.appPackageList.next_page_url:n.appPackageList.previous_page_url)}})}}}]),app.directive("transactionDebug",["ApiService","$uibModal",function(e,a){return{restrict:"A",scope:{url:"=?"},link:function(n,t,i,r){t.hide(),n.$watch("url",function(){n.url&&t.show()},!0),t.click(function(){n.transactionDebug={},n.transactionDebug.params={},n.transactionDebug.params.show="date_created,action,response,response_content_type",n.transactionDebug.params.limit=5,n.transactionDebug.params.sort_by="date_created",n.transactionDebug.params.desc=!0;var t=function(a){e.getList(a,n.transactionDebug.params).then(function(e){_.each(e.data,function(e){"xml"!=e.response_content_type&&"html"!=e.response_content_type||(e.response=vkbeautify.xml(e.response)),"json"==e.response_content_type&&(e.response=vkbeautify.json(e.response))}),n.debugList=e},function(e){n.modalError=e})};t(n.url);var i=a.open({size:"lg",templateUrl:"app/modals/debug_transaction.html",scope:n});n.transactionDebug.cancel=function(){i.dismiss()},n.transactionDebug.movePage=function(e){t("+"==e?n.debugList.next_page_url:n.debugList.previous_page_url)}})}}}]),app.directive("isProductIdAvailable",["$http","$q","ApiService",function(e,a,n){return{restrict:"A",require:"ngModel",link:function(e,a,t,i){var r=a[0],o=angular.element(r),c=angular.element(r.parentNode),s=angular.element(utils.getSiblingElements(r,"SPAN")[0]),l=angular.element(r.parentNode.parentNode);o.attr("name");o.bind("blur",function(){var a=utils.emptyToNull(r.value);c.removeClass("has-success"),l.removeClass("has-error"),s.addClass("hidden"),i.$setValidity("unavailable",!0),i.$setValidity("invalid_characters",!0),a&&(/[$\/:-?{-~!"^`\[\] ]/.test(a)?e.$apply(function(){l.addClass("has-error"),i.$setValidity("invalid_characters",!1)}):(l.removeClass("has-error"),s.removeClass("hidden"),c.addClass("has-success"),n.getItem(n.buildUrl("/products/"+a),{show:"product_id"},!1).then(function(e){l.addClass("has-error"),s.addClass("hidden"),i.$setValidity("unavailable",!1)},function(e){a&&(l.removeClass("has-error"),s.removeClass("hidden"),c.addClass("has-success"))})))})}}}]),app.directive("showErrors",function(){return{restrict:"A",require:"^form",link:function(e,a,n,t){var i=a[0].querySelector("[name]"),r=angular.element(a[0].querySelector(".help-block")),o=angular.element(a[0].getElementsByTagName("label")),c=angular.element(i),s=angular.element(r),l=angular.element(o),u=c.attr("name");null!=o&&c[0].attributes.required&&l.addClass("required"),c[0].attributes.required||c[0].attributes.conditional||c[0].attributes.placeholder||i.setAttribute("placeholder","Optional");var d="blur";i&&("checkbox"!=i.type&&"select"!=i.type&&"radio"!=i.type||(d="change")),c.bind(d,function(){("moderate"==n.showErrors||utils.isNullOrEmpty(n.showErrors))&&a.toggleClass("has-error",t[u].$invalid),"aggressive"==n.showErrors&&(a.toggleClass("has-error",t[u].$invalid),s.toggleClass("hidden",!t[u].$invalid)),0==t[u].$invalid&&s.toggleClass("hidden",!0)}),e.$on("show-errors-check-validity",function(e,n){n.formName!=t.$name&&1==n.isolateValidation||t[u]&&(a.toggleClass("has-error",t[u].$invalid),s.toggleClass("hidden",!t[u].$invalid))})}}}),app.directive("validateOnSubmit",function(){return{restrict:"A",require:"^form",link:function(e,a,n,t){a.bind("click",function(){var a={};n.isolateValidation&&(a.isolateValidation=!0,a.formName=t.$name),e.$emit("show-errors-check-validity",a),e.$broadcast("show-errors-check-validity",a)})}}}),app.directive("prices",function(){return{restrict:"A",require:"^form",templateUrl:"app/templates/prices.html",scope:{prices:"=?",currencies:"=?"},link:function(e,a,n,t){e.form=t,e.showAddPrice=function(){e.prices.push({price:"",currency:""})},e.removePrice=function(a,n){e.prices.splice(n,1)}}}}),app.directive("ranges",function(){return{restrict:"A",require:"^form",templateUrl:"app/templates/ranges.html",scope:{ranges:"=?"},link:function(e,a,n,t){e.form=t,e.showAddRange=function(){e.ranges||(e.ranges=[]),e.ranges.push({minimum:"",maximum:"",price:""})},e.removeRange=function(a,n){e.ranges.splice(n,1)}}}}),app.directive("metaToHtml",function(){return{restrict:"A",link:function(e,a,n,t){n.$observe("metaToHtml",function(e){if(0==utils.isNullOrEmpty(e)){var t=utils.jsonToHtmlTable(e,!0,n.panelTitle);a.html(t)}})}}}),app.directive("address",["GeographiesService",function(e){return{restrict:"AE",templateUrl:"app/templates/address_display.html",scope:{address:"=?",edit:"=?"},link:function(a,n,t){var i=e.getGeographies();a.countries=i.countries}}}]),app.directive("customerEdit",["ApiService",function(e){return{restrict:"AE",templateUrl:"app/templates/customer.html",scope:{customer:"=?customerEdit",cart:"=?",invoice:"=?",onSave:"=?",error:"=?"},link:function(a,n,t){var i={};a.edit=!1,a.$watch("edit",function(e){e?(i=angular.copy(a.customer),a.edit=!0):(i={},a.edit=!1)}),a.cancel=function(){a.error=null,a.customer=i,a.edit=!1},a.save=function(n){if(a.error=null,!n.$invalid){if(void 0===t.commitOnSave||"true"==t.commitOnSave){var i=a.customer.url||e.buildUrl("/customers"),r=a.customer;return a.cart&&a.cart.url&&(i=a.cart.url,r={customer:a.customer}),a.invoice&&a.invoice.url&&(i=a.invoice.url,r={customer:a.customer}),e.set(r,i,{formatted:!0,expand:"options"}).then(function(e){a.cart&&a.cart.url?a.cart=e:a.invoice&&a.invoice.url?a.invoice=e:a.customer=e,a.edit=!1,a.onSave&&onSave(e)},function(e){a.error=e}),void(a.onSave&&a.onSave(customer))}a.edit=!1}}}}}]),app.directive("customerSelect",["ApiService","ConfirmService","GrowlsService","$uibModal","$rootScope",function(e,a,n,t,i){return{restrict:"A",scope:{customer:"=?",onSelect:"=?",error:"=?"},link:function(a,n,i,r){n.click(function(){a.customerSelect={},a.customerSelect.params={},a.customerSelect.params.hide="payments,refunds,orders,subscriptions,invoices",a.customerSelect.params.limit=10,a.customerSelect.params.date_type="date_created",a.customerSelect.params.desc=!0,a.newCustomer={tax_exempt:!1};var n=function(n){e.getList(n,a.customerSelect.params).then(function(e){a.customerList=e},function(e){a.modalError=e})};n(e.buildUrl("/customers")),utils.hasPermission("customers","create")?a.customerSelectTabs=[{active:!0},{active:!1}]:a.customerSelectTabs=[{active:!1},{active:!0}];var i=t.open({size:"lg",templateUrl:"app/modals/customer_select.html",scope:a});i.result.then(function(e){a.customer=e,a.modalError=null,a.onSelect&&a.onSelect(e)},function(){a.modalError=null}),a.customerSelect.ok=function(e){i.close(e)},a.customerSelect.cancel=function(){i.dismiss()},a.customerSelect.search=function(){a.customerSelect.params.q=a.customerSelect.q,n(e.buildUrl("/customers"))},a.customerSelect.sort=function(t,i){a.customerSelect.params.date_type=t,a.customerSelect.params.desc=i,n(e.buildUrl("/customers"))},a.customerSelect.setParam=function(t,i){a.customerSelect.params[t]=i,n(e.buildUrl("/customers"))},a.customerSelect.create=function(n){n.$invalid||e.set(a.newCustomer,e.buildUrl("/customers")).then(function(e){i.close(e)},function(e){a.modalError=e})},a.customerSelect.movePage=function(e){n("+"==e?a.customerList.next_page_url:a.customerList.previous_page_url)}})}}}]),app.directive("invoiceItemSelect",["ApiService","ConfirmService","GrowlsService","$uibModal","$rootScope","$location",function(e,a,n,t,i,r){return{restrict:"A",scope:{invoice:"=?invoiceItemSelect",parameters:"=?",error:"=?"},link:function(a,n,i,o){n.click(function(){a.itemSelect={},a.itemSelect.params={},a.itemSelect.params.show="name,product_id,price,currency,status,active,deleted,date_created,date_modified,type",a.itemSelect.params.limit=10,a.itemSelect.params.sort_by="name",a.itemSelect.params.formatted=!0,a.itemSelect.params.currency=a.invoice.currency,a.itemSelect.params.desc=!1,a.currencies=JSON.parse(localStorage.getItem("payment_currencies")),a.newItem={reference_currency:a.invoice.currency},a.invoice&&null==a.invoice.items&&(a.invoice.items=[]);var n=function(n){e.getList(n,a.itemSelect.params).then(function(e){a.productList=e},function(e){a.modalError=e})};n(e.buildUrl("/products")),a.itemSelectTabs=[{active:!0},{active:!1}];var i=t.open({size:"lg",templateUrl:"app/modals/invoice_item_select.html",scope:a});i.result.then(function(e){a.item=e,a.modalError=null},function(){a.modalError=null});var o=!1,c=function(){var n=a.invoice.url||e.buildUrl("/invoices");return null==a.invoice.url&&(o=!0),e.set(a.invoice,n,a.parameters)};a.itemSelect.ok=function(e){var n=_.findWhere(a.invoice.items,{product_id:e.product_id});if(null!=n)return void i.close(n);var t={product_id:e.product_id,quantity:1};a.invoice.items.push(t),c().then(function(e){a.invoice=e,i.close(t),o&&r.path("/invoices/"+e.invoice_id)},function(n){a.invoice.items=_.filter(a.invoice.items,function(a){return a.product_id!=e.product_id}),a.modalError=n;
})},a.itemSelect.cancel=function(){i.dismiss()},a.itemSelect.search=function(){a.itemSelect.params.q=a.itemSelect.q,n(e.buildUrl("/products"))},a.itemSelect.sort=function(t,i){a.itemSelect.params.date_type=t,a.itemSelect.params.desc=i,n(e.buildUrl("/products"))},a.itemSelect.setParam=function(t,i){a.itemSelect.params[t]=i,n(e.buildUrl("/products"))},a.itemSelect.create=function(e){if(!e.$invalid){var n=_.findWhere(a.invoice.items,{item_id:a.newItem.item_id});if(null!=n)return void(a.modalError={message:"An item with the same ID already exists. You must choose a unique item ID."});a.invoice.items.push(a.newItem),c().then(function(e){a.invoice=e,i.close(a.newItem),o&&r.path("/invoices/"+e.invoice_id)},function(e){a.invoice.items=_.filter(a.invoice.items,function(e){return e.item_id!=a.newItem.item_id}),a.modalError=e})}},a.itemSelect.movePage=function(e){n("+"==e?a.productList.next_page_url:a.productList.previous_page_url)}})}}}]),app.directive("download",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{download:"=?",error:"=?"},link:function(a,i,r,o){i.click(function(){a.downloadDetails={},a.downloadDetails.params={},a.data={},a.data.expires=new Date(a.download.expires),a.datepicker={},a.datepicker.status={},a.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},a.datepicker.status.expires={opened:!1},a.datepicker.open=function(e,n){a.datepicker.status[n].opened=!0};var i=t.open({size:"lg",templateUrl:"app/modals/download.html",scope:a});a.downloadDetails.close=function(){i.close()},a.downloadDetails.ok=function(t){a.modalError=null,t.$invalid||(a.download.expires=a.data.expires.toISOString(),e.set(a.download,e.buildUrl("/downloads/"+a.download.download_id),{expand:"file"}).then(function(e){n.addGrowl({id:"edit_success_no_link"}),a.download=e,i.close()},function(e){a.modalError=e}))},a.downloadDetails.reset=function(){a.modalError=null,e.set(null,e.buildUrl("/downloads/"+a.download.download_id+"/reset"),{expand:"file"}).then(function(e){n.addGrowl({id:"download_reset"}),a.download=e,i.close()},function(e){a.modalError=e})},a.downloadDetails.kill=function(){a.modalError=null,e.set(null,e.buildUrl("/downloads/"+a.download.download_id+"/kill"),{expand:"file"}).then(function(e){n.addGrowl({id:"download_kill"}),a.download=e,i.close()},function(e){a.modalError=e})},i.result.then(function(e){a.modalError=null},function(){a.modalError=null})})}}}]),app.directive("createDownload",["ApiService","ConfirmService","GrowlsService","$uibModal",function(e,a,n,t){return{restrict:"A",scope:{file:"=?",error:"=?"},link:function(a,i,r,o){i.click(function(){e.set({},a.file.url+"/downloads",{expand:"file",formatted:!0}).then(function(i){a.download=i,a.downloadDetails={},a.downloadDetails.params={},a.data={},a.data.expires=new Date(a.download.expires),a.datepicker={},a.datepicker.status={},a.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},a.datepicker.status.expires={opened:!1},a.datepicker.open=function(e,n){a.datepicker.status[n].opened=!0};var r=t.open({size:"lg",templateUrl:"app/modals/download.html",scope:a});a.downloadDetails.close=function(){r.close()},a.downloadDetails.ok=function(t){a.modalError=null,t.$invalid||(a.download.expires=a.data.expires.toISOString(),e.set(i,e.buildUrl("/downloads/"+a.download.download_id),{expand:"file"}).then(function(e){n.addGrowl({id:"edit_success_no_link"}),a.download=e,r.close()},function(e){a.modalError=e}))},a.downloadDetails.reset=function(){a.modalError=null,e.set(null,e.buildUrl("/downloads/"+a.download.download_id+"/reset"),{expand:"file"}).then(function(e){n.addGrowl({id:"download_reset"}),a.download=e,r.close()},function(e){a.modalError=e})},a.downloadDetails.kill=function(){a.modalError=null,e.set(null,e.buildUrl("/downloads/"+a.download.download_id+"/kill"),{expand:"file"}).then(function(e){n.addGrowl({id:"download_kill"}),a.download=e,r.close()},function(e){a.modalError=e})},r.result.then(function(e){a.modalError=null},function(){a.modalError=null})},function(e){a.error=e,window.scrollTo(0,0)})})}}}]),app.directive("license",["$uibModal",function(e){return{restrict:"A",scope:{license:"=?",error:"=?"},link:function(a,n,t,i){n.click(function(){a.licenseDetails={},a.licenseDetails.params={},a.data={},a.options={html:!0},a.renderedLicenseText=a.license.label+":\n"+a.license.text,a.license.instructions&&(a.renderedLicenseText+="\n\n"+a.license.instructions),a.renderedLicenseHtml=a.license.label+"<br>"+a.license.html,a.license.instructions&&(a.renderedLicenseHtml+="<br><br>"+a.license.instructions);var n=e.open({size:"lg",templateUrl:"app/modals/license.html",scope:a});a.licenseDetails.close=function(){n.close()},n.result.then(function(e){a.modalError=null},function(){a.modalError=null})})}}}]),app.filter("bytesToMB",function(){return function(e){return(e/1e6).toFixed(2)+" MB"}}),app.filter("humanBool",function(){return function(e){if(null!=e)return 1==e?"yes":"no"}}),app.filter("money",function(){return function(e,a){var n=localStorage.getItem("locale");null==n&&(n="en-us");var t=new Intl.NumberFormat(n,{style:"currency",currency:a,minimumFractionDigits:2});return t.format(e)}}),app.filter("truncate",function(){return function(e,a){var n="...";if(null!=e)return e.length<=a||e.length-n.length<=a?e:String(e).substring(0,a-n.length).trim()+n}}),app.filter("countryCodeToName",["GeographiesService",function(e){return function(a){if(null==a)return null;var n=e.getGeographies(),t=_.findWhere(n.countries,{code:a});return t.name}}]),app.filter("truncateUrl",function(){return function(e,a){var n="...";if(null!=e)return e.length<=a||e.length-n.length<=a?e:String(e).substring(0,a)+n+utils.right(e,10)}}),app.filter("replace",function(){return function(e,a,n){if(null!=e)return e.split(a).join(n)}}),app.filter("stringToColor",function(){return function(e){if(null!=e){for(var a=0,n=0;a<e.length;n=e.charCodeAt(a++)+((n<<5)-n));for(var a=0,t="#";a<3;t+=("00"+(n>>8*a++&255).toString(16)).slice(-2));return t}return"red"}}),app.filter("percentage",["$filter",function(e){return function(a,n){return e("number")(100*a,n)+"%"}}]),app.service("GrowlsService",["$rootScope",function(e){function a(a){var n=utils.getRandom(),t="success";null!=a.type&&(t=a.type);var i=5;switch(t){case"success":i=5;break;case"info":i=5;break;case"warning":i=10;break;case"danger":i=-1}utils.isValidNumber(a.duration)&&(i=a.duration),i>120&&(i=120),a.ref=n,a.duration=i,a.type=t,e.$broadcast("event:growl",a)}return{addGrowl:a}}]),app.service("SettingsService",["$rootScope","$q","ApiService",function(e,a,n){function t(){return e.account={},e.account.account_id=localStorage.getItem("account_id"),n.getItem(n.buildUrl("/accounts/"+e.account.account_id+"/meta")).then(function(a){e.account.alias=a.alias,localStorage.setItem("alias",a.alias),e.account.live=a.live,localStorage.setItem("live",a.live),e.account.reporting_currency_primary=a.reporting_currency_primary,localStorage.setItem("reporting_currency_primary",a.reporting_currency_primary),e.account.reporting_currency_secondary=a.reporting_currency_secondary,localStorage.setItem("reporting_currency_secondary",a.reporting_currency_secondary),e.account.payment_currencies=a.payment_currencies,localStorage.setItem("payment_currencies",JSON.stringify(a.payment_currencies)),e.account.default_payment_currency=a.default_payment_currency,localStorage.setItem("default_payment_currency",a.default_payment_currency),e.plan_select_url="https://"+a.alias+".auth.comecero.com/plan/select",window.location.hostname.indexOf("admin-staging.")>-1&&(e.plan_select_url=e.plan_select_url.replace(".auth.comecero.com",".auth-staging.comecero.com"))})}function i(){e.user={},e.user.user_id=localStorage.getItem("user_id"),e.user.name=localStorage.getItem("name"),e.settings={},e.settings.test=utils.stringToBool(localStorage.getItem("test")),e.logout=function(){var e=localStorage.getItem("alias"),t=(a.defer(),[]);localStorage.getItem("token")&&t.push(n.remove(n.buildUrl("/auths/me"),null,!0,localStorage.getItem("token"))),localStorage.getItem("token_live")&&t.push(n.remove(n.buildUrl("/auths/me"),null,!0,localStorage.getItem("token_live"))),localStorage.getItem("token_limited_test")&&t.push(n.remove(n.buildUrl("/auths/me"),null,!0,localStorage.getItem("token_limited_test"))),t.length>0?a.all(t).then(function(){i()},function(e){i()}):i();var i=function(){localStorage.clear(),window.location.href="https://"+e+".auth.comecero.com/?logout=1"}},t()}return{setUserSettings:i,setAccountMeta:t}}]),app.service("ConfirmService",["$uibModal",function(e){function a(a,n){a.confirm=n,openConfirm=e.open({templateUrl:"app/modals/confirm.html",scope:a}),n.ok=function(){openConfirm.close(),n.onConfirm()},n.cancel=function(){openConfirm.close()}}return{showConfirm:a}}]),app.service("GeographiesService",[function(){function e(e){var a={};return a.countries=[{name:"Afghanistan",code:"AF"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia, Plurinational State of",code:"BO"},{name:"Bonaire, Sint Eustatius and Saba",code:"BQ"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, the Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote d Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Curacao",code:"CW"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands",code:"AX"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guine Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and McDonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao Peoples Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia",code:"FM"},{name:"Moldova",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montenegro",code:"ME"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Barthélemy",code:"BL"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Martin French",code:"MF"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia",code:"RS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Sint Maarten Dutch",code:"SX"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"South Sudan",code:"SS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Viet Nam",code:"VN"},{name:"Virgin Islands British",code:"VG"},{name:"Virgin Islands U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}],a.us_states=[{name:"Alabama",code:"AL"},{name:"Alaska",code:"AK"},{name:"American Samoa",code:"AS"},{name:"Arizona",code:"AZ"},{name:"Arkansas",code:"AR"},{name:"California",code:"CA"},{name:"Colorado",code:"CO"},{name:"Connecticut",code:"CT"},{name:"Delaware",code:"DE"},{name:"District Of Columbia",code:"DC"},{name:"Federated States Of Micronesia",code:"FM"},{name:"Florida",code:"FL"},{name:"Georgia",code:"GA"},{name:"Guam",code:"GU"},{name:"Hawaii",code:"HI"},{name:"Idaho",code:"ID"},{name:"Illinois",code:"IL"},{name:"Indiana",code:"IN"},{name:"Iowa",code:"IA"},{name:"Kansas",code:"KS"},{name:"Kentucky",code:"KY"},{name:"Louisiana",code:"LA"},{name:"Maine",code:"ME"},{name:"Marshall Islands",code:"MH"},{name:"Maryland",code:"MD"},{name:"Massachusetts",code:"MA"},{name:"Michigan",code:"MI"},{name:"Minnesota",code:"MN"},{name:"Mississippi",code:"MS"},{name:"Missouri",code:"MO"},{name:"Montana",code:"MT"},{name:"Nebraska",code:"NE"},{name:"Nevada",code:"NV"},{name:"New Hampshire",code:"NH"},{name:"New Jersey",code:"NJ"},{name:"New Mexico",code:"NM"},{name:"New York",code:"NY"},{name:"North Carolina",code:"NC"},{name:"North Dakota",code:"ND"},{name:"Northern Mariana Islands",code:"MP"},{name:"Ohio",code:"OH"},{name:"Oklahoma",code:"OK"},{name:"Oregon",code:"OR"},{name:"Palau",code:"PW"},{name:"Pennsylvania",code:"PA"},{name:"Puerto Rico",code:"PR"},{name:"Rhode Island",code:"RI"},{name:"South Carolina",code:"SC"},{name:"South Dakota",code:"SD"},{name:"Tennessee",code:"TN"},{name:"Texas",code:"TX"},{name:"Utah",code:"UT"},{name:"Vermont",code:"VT"},{name:"Virgin Islands",code:"VI"},{name:"Virginia",code:"VA"},{name:"Washington",code:"WA"},{name:"West Virginia",code:"WV"},{name:"Wisconsin",code:"WI"},{name:"Wyoming",code:"WY"},{name:"U.S. Armed Forces Americas",code:"AA"},{name:"U.S. Armed Forces Europe",code:"AE"},{name:"U.S. Armed Forces Pacific",code:"AP"}],a.ca_provinces=[{code:"AB",name:"Alberta"},{code:"BC",name:"British Columbia"},{code:"LB",name:"Labrador"},{code:"MB",name:"Manitoba"},{code:"NB",name:"New Brunswick"},{code:"NF",name:"Newfoundland"},{code:"NS",name:"Nova Scotia"},{code:"NU",name:"Nunavut"},{code:"NW",name:"Northwest Territories"},{code:"ON",name:"Ontario"},{code:"PE",name:"Prince Edward Island"},{code:"QC",name:"Quebec"},{code:"SK",name:"Saskatchewen"},{code:"YU",name:"Yukon"}],a.au_states=[{code:"NT",name:"Northern Territory"},{code:"QLD",name:"Queensland"},{code:"SA",name:"South Australia"},{code:"TAS",name:"Tasmania"},{code:"VIC",name:"Victoria"},{code:"WA",name:"Western Australia"}],a.eu_countries=[{name:"Austria",code:"AT"},{name:"Belgium",code:"BE"},{name:"Bulgaria",code:"BG"},{name:"Croatia",code:"HR"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Estonia",code:"EE"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"Germany",code:"DE"},{name:"Greece",code:"GR"},{name:"Hungary",code:"HU"},{name:"Ireland",code:"IE"},{name:"Italy",code:"IT"},{name:"Latvia",code:"LV"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Malta",code:"MT"},{name:"Netherlands",code:"NL"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Romania",code:"RO"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Spain",code:"ES"},{name:"Sweden",code:"SE"},{name:"United Kingdom",code:"GB"}],0!=e&&(a.countries.unshift({name:"",code:""}),a.us_states.unshift({name:"",code:""}),a.ca_provinces.unshift({name:"",code:""}),a.au_states.unshift({name:"",code:""})),a}function a(a){return null!=_.find(e(!1).eu_countries,{code:a})}return{getGeographies:e,isEuCountry:a}}]),app.service("CouriersService",[function(){function e(){var e=[{value:null,name:"Optional"},{value:"UPS",name:"UPS"},{value:"FedEx",name:"FedEx"},{value:"USPS",name:"United States Postal Service"},{value:"DHLUSA",name:"DHL USA"},{value:"DHLEcommerce",name:"DHL eCommerce"},{value:"OnTrac",name:"OnTrac"},{value:"ICCWorldwide",name:"ICC Worldwide"},{value:"LaserShip",name:"LaserShip"},{value:"CanadaPost",name:"Canada Post"},{value:"AustraliaPost",name:"Australia Post"},{value:"RoyalMail",name:"Royal Mail"},{value:"",name:"Other"}];return e}return{getCouriers:e}}]),app.service("CurrenciesService",[function(){function e(){var e=[{code:"AED",name:"UAE Dirham"},{code:"AFN",name:"Afghani"},{code:"ALL",name:"Lek"},{code:"AMD",name:"Armenian Dram"},{code:"ANG",name:"Netherlands Antillean Guilder"},{code:"AOA",name:"Kwanza"},{code:"ARS",name:"Argentine Peso"},{code:"AUD",name:"Australian Dollar"},{code:"AWG",name:"Aruban Florin"},{code:"AZN",name:"Azerbaijanian Manat"},{code:"BAM",name:"Convertible Mark"},{code:"BBD",name:"Barbados Dollar"},{code:"BDT",name:"Taka"},{code:"BGN",name:"Bulgarian Lev"},{code:"BHD",name:"Bahraini Dinar"},{code:"BIF",name:"Burundi Franc"},{code:"BMD",name:"Bermudian Dollar"},{code:"BND",name:"Brunei Dollar"},{code:"BOB",name:"Boliviano"},{code:"BRL",name:"Brazilian Real"},{code:"BSD",name:"Bahamian Dollar"},{code:"BWP",name:"Pula"},{code:"BYR",name:"Belarussian Ruble"},{code:"BZD",name:"Belize Dollar"},{code:"CAD",name:"Canadian Dollar"},{code:"CDF",name:"Congolese Franc"},{code:"CHF",name:"Swiss Franc"},{code:"CLP",name:"Chilean Peso"},{code:"CNY",name:"Yuan Renminbi"},{code:"COP",name:"Colombian Peso"},{code:"CRC",name:"Costa Rican Colon"},{code:"CVE",name:"Cape Verde Escudo"},{code:"CZK",name:"Czech Koruna"},{code:"DJF",name:"Djibouti Franc"},{code:"DKK",name:"Danish Krone"},{code:"DOP",name:"Dominican Peso"},{code:"DZD",name:"Algerian Dinar"},{code:"EGP",name:"Egyptian Pound"},{code:"ERN",name:"Nakfa"},{code:"ETB",name:"Ethiopian Birr"},{code:"EUR",name:"Euro"},{code:"FJD",name:"Fiji Dollar"},{code:"FKP",name:"Falkland Islands Pound"},{code:"GBP",name:"Pound Sterling"},{code:"GEL",name:"Lari"},{code:"GHS",name:"Ghana Cedi"},{code:"GIP",name:"Gibraltar Pound"},{code:"GMD",name:"Dalasi"},{code:"GNF",name:"Guinea Franc"},{code:"GTQ",name:"Quetzal"},{code:"GYD",name:"Guyana Dollar"},{code:"HKD",name:"Hong Kong Dollar"},{code:"HNL",name:"Lempira"},{code:"HRK",name:"Croatian Kuna"},{code:"HTG",name:"Gourde"},{code:"HUF",name:"Forint"},{code:"IDR",name:"Rupiah"},{code:"ILS",name:"New Israeli Sheqel"},{code:"INR",name:"Indian Rupee"},{code:"IQD",name:"Iraqi Dinar"},{code:"ISK",name:"Iceland Krona"},{code:"JMD",name:"Jamaican Dollar"},{code:"JOD",name:"Jordanian Dinar"},{code:"JPY",name:"Yen"},{code:"KES",name:"Kenyan Shilling"},{code:"KGS",name:"Som"},{code:"KHR",name:"Riel"},{code:"KMF",name:"Comoro Franc"},{code:"KRW",name:"Won"},{code:"KWD",name:"Kuwaiti Dinar"},{code:"KYD",name:"Cayman Islands Dollar"},{code:"KZT",name:"Tenge"},{code:"LAK",name:"Kip"},{code:"LBP",name:"Lebanese Pound"},{code:"LKR",name:"Sri Lanka Rupee"},{code:"LRD",name:"Liberian Dollar"},{code:"LTL",name:"Lithuanian Litas"},{code:"LVL",name:"Latvian lats"},{code:"MAD",name:"Moroccan Dirham"},{code:"MDL",name:"Moldovan Leu"},{code:"MGA",name:"Malagasy Ariary"},{code:"MKD",name:"Denar"},{code:"MMK",name:"Kyat"},{code:"MNT",name:"Tugrik"},{code:"MOP",name:"Pataca"},{code:"MRO",name:"Ouguiya"},{code:"MUR",name:"Mauritius Rupee"},{code:"MVR",name:"Rufiyaa"},{code:"MWK",name:"Kwacha"},{code:"MXN",name:"Mexican Peso"},{code:"MYR",name:"Malaysian Ringgit"},{code:"MZN",name:"Mozambique Metical"},{code:"NGN",name:"Naira"},{code:"NIO",name:"Cordoba Oro"},{code:"NOK",name:"Norwegian Krone"},{code:"NPR",name:"Nepalese Rupee"},{code:"NZD",name:"New Zealand Dollar"},{code:"OMR",name:"Rial Omani"},{code:"PEN",name:"Nuevo Sol"},{code:"PGK",name:"Kina"},{code:"PHP",name:"Philippine Peso"},{code:"PKR",name:"Pakistan Rupee"},{code:"PLN",name:"Zloty"},{code:"PYG",name:"Guarani"},{code:"QAR",name:"Qatari Rial"},{code:"RON",name:"New Romanian Leu"},{code:"RSD",name:"Serbian Dinar"},{code:"RUB",name:"Russian Ruble"},{code:"RWF",name:"Rwanda Franc"},{code:"SAR",name:"Saudi Riyal"},{code:"SBD",name:"Solomon Islands Dollar"},{code:"SCR",name:"Seychelles Rupee"},{code:"SEK",name:"Swedish Krona"},{code:"SGD",name:"Singapore Dollar"},{code:"SHP",name:"Saint Helena Pound"},{code:"SLL",name:"Leone"},{code:"SOS",name:"Somali Shilling"},{code:"SRD",name:"Surinam Dollar"},{code:"STD",name:"Dobra"},{code:"SZL",name:"Lilangeni"},{code:"THB",name:"Baht"},{code:"TJS",name:"Somoni"},{code:"TMT",name:"Turkmenistan New Manat"},{code:"TND",name:"Tunisian Dinar"},{code:"TOP",name:"Pa?anga"},{code:"TRY",name:"Turkish Lira"},{code:"TTD",name:"Trinidad and Tobago Dollar"},{code:"TWD",name:"New Taiwan Dollar"},{code:"TZS",name:"Tanzanian Shilling"},{code:"UAH",name:"Hryvnia"},{code:"UGX",name:"Uganda Shilling"},{code:"USD",name:"US Dollar"},{code:"UYU",name:"Peso Uruguayo"},{code:"UZS",name:"Uzbekistan Sum"},{code:"VEF",name:"Bolivar"},{code:"VND",name:"Dong"},{code:"VUV",name:"Vatu"},{code:"WST",name:"Tala"},{code:"XAF",name:"CFA Franc BEAC"},{code:"XCD",name:"East Caribbean Dollar"},{code:"XOF",name:"CFA Franc BCEAO"},{code:"XPF",name:"CFP Franc"},{code:"YER",name:"Yemeni Rial"},{code:"ZAR",name:"Rand"},{code:"ZMW",name:"Zambian kwacha"},{code:"ZWL",name:"Zimbabwe Dollar"}];return e}return{getCurrencies:e}}]),app.service("TimezonesService",[function(){function e(){var e=["Asia/China","America/Alaska","America/Atlantic_Time","America/Arizona","America/Central_Time","America/Eastern_Time","America/Hawaii","America/Mountain_Time","America/Newfoundland","America/Pacific_Time","Europe/Central","Europe/Eastern","Europe/GMT","Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Asmera","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Timbuktu","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/ComodRivadavia","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Atka","America/Bahia","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Buenos_Aires","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Catamarca","America/Cayenne","America/Cayman","America/Chicago","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Cordoba","America/Costa_Rica","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Ensenada","America/Fort_Wayne","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Indianapolis","America/Inuvik","America/Iqaluit","America/Jamaica","America/Jujuy","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Knox_IN","America/La_Paz","America/Lima","America/Los_Angeles","America/Los_Angeles","America/Louisville","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Mendoza","America/Menominee","America/Merida","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Phoenix","America/Port_of_Spain","America/Port-au-Prince","America/Porto_Acre","America/Porto_Velho","America/Puerto_Rico","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Rosario","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Shiprock","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Virgin","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/South_Pole","Antarctica/Syowa","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Ashkhabad","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Calcutta","Asia/Choibalsan","Asia/Chongqing","Asia/Chungking","Asia/Colombo","Asia/Dacca","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Istanbul","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Katmandu","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macao","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Saigon","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Tel_Aviv","Asia/Thimbu","Asia/Thimphu","Asia/Tokyo","Asia/Ujung_Pandang","Asia/Ulaanbaatar","Asia/Ulan_Bator","Asia/Urumqi","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faeroe","Atlantic/Faroe","Atlantic/Jan_Mayen","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/ACT","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Canberra","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/LHI","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/North","Australia/NSW","Australia/Perth","Australia/Queensland","Australia/South","Australia/Sydney","Australia/Tasmania","Australia/Victoria","Australia/West","Australia/Yancowinna","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belfast","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Nicosia","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Tiraspol","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Ponape","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Samoa","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Truk","Pacific/Wake","Pacific/Wallis","Pacific/Yap","UTC"];
return e}return{getTimezones:e}}]),app.service("HelperService",[function(){function e(){var e=localStorage.getItem("token");return!(!e||"admin"!=e.substring(0,5))}return{isAdmin:e}}]);