app.controller("AccountsUpdateCtrl",["$scope","$location","ApiService","ConfirmService","GrowlsService","GeographiesService",function(e,t,r,i,n,s){e.exception={};var o=function(){e.exception.error=null};e.url=r.buildUrl("/accounts/"+localStorage.getItem("account_id")),e.confirmCancel=function(){if(angular.equals(e.account,e.account_orig))utils.redirect(t,"/");else{var r={id:"changes_lost"};r.onConfirm=function(){utils.redirect(t,"/")},i.showConfirm(e,r)}};var a=s.getGeographies(!1);e.countries=a.countries,e.us_states=a.us_states,e.ca_provinces=a.ca_provinces,e.au_states=a.au_states,0==utils.inTestMode()&&r.getItem(e.url).then(function(t){e.account=t,e.account_orig=angular.copy(e.account),e.typeahead={},e.typeahead.country={},e.typeahead.state_prov={},null!=e.account.country&&(e.typeahead.country=_.find(e.countries,{code:e.account.country})),null!=e.account.state_prov&&("US"==e.account.country&&(e.typeahead.state_prov=_.find(e.us_states,{code:e.account.state_prov})),"CA"==e.account.country&&(e.typeahead.state_prov=_.find(e.ca_provinces,{code:e.account.state_prov})),"AU"==e.account.country&&(e.typeahead.state_prov=_.find(e.au_states,{code:e.account.state_prov})))},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCountrySelect=function(t,r,i){e.account.country=r.code},e.onStateSelect=function(t,r,i){e.account.state_prov=r.code},e.updateAccount=function(){o(),e.form.$invalid||r.set(e.account,e.url).then(function(e){n.addGrowl({id:"edit_success_no_link",type:"success"}),utils.redirect(t,"/")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadContractPdf=function(){r.getItemPdf(r.buildUrl("/contracts/current")).then(function(e){var t=new Blob([e],{type:"application/pdf"});saveAs(t,"Contract_"+localStorage.getItem("account_id")+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("AppsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.appListUrl=s.buildUrl("/apps"),e.meta={};var o=localStorage.getItem("alias");e.meta.app_install_url_base="https://"+o+".auth.comecero.com/oauth/callback/#access_token="+localStorage.getItem("token")+"&redirect_uri=",e.meta.test=localStorage.getItem("test")}]),app.controller("AppsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.app_display={},null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/apps/"+t.id),n.getItem(e.url,{expand:"images,app_package,source_app_package"}).then(function(t){e.app=t,t.settings_fields&&(e.app_display.settings_fields=JSON.stringify(t.settings_fields,null,4)),t.style_fields&&(e.app_display.style_fields=JSON.stringify(t.style_fields,null,4)),e.images=t.images,"app_default"==t.images[0].image_id&&(e.images=[]),e.redirect_uris=utils.arrayToString(t.redirect_uris),e.csp_hosts=utils.arrayToString(t.csp_hosts),null!=t.app_package&&(e.app_package=t.app_package,e.app_package_id=t.app_package.app_package_id),null!=t.source_app_package&&(e.source_app_package=t.source_app_package,e.source_app_package_id=t.source_app_package.app_package_id),delete e.app.app_package,delete e.app.source_app_package,delete e.app.images,e.app_orig=angular.copy(e.app)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.app={is_public:!1,active:!1,hash_navigation:!1,allow_custom_css:!1,allow_custom_javascript:!1},e.images=[]),e.$watch("app_package",function(t,r){null!=t&&(e.app_package_id=t.app_package_id)}),e.$watch("source_app_package",function(t,r){null!=t&&(e.source_app_package_id=t.app_package_id)}),e.removeAppPackage=function(){e.app.app_package_id=null,e.app_package.app_package_id=null,e.showAppPackage=!1},e.removeSourceAppPackage=function(){e.app.source_app_package_id=null,e.source_app_package.source_app_package_id=null,e.showSourceAppPackage=!1};var o=function(){e.exception.error=null,null!=e.app_package&&(e.app.app_package_id=e.app_package.app_package_id),null!=e.source_app_package&&(e.app.source_app_package_id=e.source_app_package.app_package_id),null!=e.images&&_.each(e.images,function(t){null==e.app.image_ids&&(e.app.image_ids=[]),e.app.image_ids.push(t.image_id)}),0==e.app.client_side&&(e.app.type=null),0==e.app.platform_hosted&&(e.app.app_package_id=null,e.app.source_app_package=null,e.app.allow_source_download=!1,e.app.version=null,e.app.csp_hosts=null),"storefront"==e.app.type&&(e.redirect_uris=null,e.app.permissions=[]),null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),null!=e.csp_hosts&&(e.app.csp_hosts=utils.stringToArray(e.csp_hosts))};e.confirmCancel=function(){if(angular.equals(e.app,e.app_orig))utils.redirect(r,"/apps");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/apps")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.setConditionals=function(){0==e.app.client_side&&(e.app.type=null,e.app.platform_hosted=!1),"storefront"==e.app.type&&(e.app.platform_hosted=!0)},e.addApp=function(){if(o(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):void n.set(e.app,n.buildUrl("/apps"),{show:"app_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(r,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateApp=function(){if(o(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):(delete e.app.effective_permissions,void n.set(e.app,e.url,{show:"app_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",app_id:e.app_id,url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(r,"/apps")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){n.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.app.name,type:"success",url:"#/apps/"+e.app.app_id+"/edit"}),utils.redirect(r,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){n.set({deleted:!1},e.url,{show:"app_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.app.name,type:"success",app_id:e.app.app_id,url:"#/apps/"+t.app_id+"/edit"}),utils.redirect(r,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.stringify=function(e){return Json.stringify(e)}}]),app.controller("AppInstallationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s,o){e.exception={},e.resources={},e.resources.appInstallationListUrl=s.buildUrl("/app_installations"),e.meta={},e.meta.test=localStorage.getItem("test");var a=localStorage.getItem("alias");e.meta.app_install_url_base="https://"+a+".auth.comecero.com/oauth/callback/#access_token="+localStorage.getItem("token")+"&test="+e.meta.test+"&redirect_uri=",e.functions={},e.functions.uninstall=function(t,r){var i=s.buildUrl("/app_installations/"+t);s.remove(i).then(function(){n.addGrowl({id:"uninstall_success",name:r,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmUninstall=function(t,r){var i={id:"app_uninstall"};i.onConfirm=function(){e.functions.uninstall(t,r)},o.showConfirm(e,i)},e.functions.setDefaultVersion=function(t,r){var i=s.buildUrl("/app_installations/"+t),o={is_default_version:!0};s.set(o,i,{show:"name"}).then(function(t){n.addGrowl({id:"set_default_app_version",name:t.name,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmSetDefaultVersion=function(t){var r={id:"set_default_app_version"};r.onConfirm=function(){e.functions.setDefaultVersion(t)},o.showConfirm(e,r)}}]),app.controller("AppInstallationsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.selections={},e.url=n.buildUrl("/app_installations/"+t.id),e.checkboxState={},n.getItem(e.url,{show:"app_installation_id,app_id,name,settings_fields.*,settings,alias,launch_url,location_url,allow_custom_javascript,custom_javascript"}).then(function(t){e.app_installation=t,null!=t.settings&&(e.selections=t.settings),e.settings_orig=angular.copy(e.app_installation.settings),e.app_host=utils.left(t.location_url,t.location_url.length-t.alias.length-1)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.config,e.config_orig))utils.redirect(r,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/app_installations")},s.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.settings=e.selections,e.exception={},n.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(n){i.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/settings"}),t||utils.redirect(r,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AppInstallationsStyleCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.selections={},e.url=n.buildUrl("/app_installations/"+t.id),e.checkboxState={},n.getItem(e.url,{show:"app_installation_id,app_id,name,style_fields.*,style,allow_custom_css,custom_css"}).then(function(t){e.app_installation=t,null!=t.style&&(e.selections=t.style),e.style_orig=angular.copy(e.app_installation.style)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.style,e.style_orig))utils.redirect(r,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/app_installations")},s.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.style=e.selections,e.exception={},n.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(n){i.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/style"}),t||utils.redirect(r,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AuthsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.auths={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadAuths=function(){s.getList(s.buildUrl("/auths?show=auth_id,token,comments,expires,date_created&sort_by="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.auths.authList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.auths.authList.next_page_offset:e.params.offset=e.auths.authList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadAuths()}),e.parseParams(),e.loadAuths()}]),app.controller("AuthsSetCtrl",["$scope","$rootScope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","$http",function(e,t,r,i,n,s,o,a){e.exception={},e.data={},e.data.type="secret",e.data.test=!0,null!=r.id?(e.update=!0,e.add=!1,e.url=s.buildUrl("/auths/"+r.id),s.getItem(e.url).then(function(t){e.auth=t,e.auth_orig=angular.copy(e.auth)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.auth={});var c=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.auth,e.auth_orig))utils.redirect(i,"/auths");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(i,"/auths")},o.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},o.showConfirm(e,t)},e.addAuth=function(){c(),e.form.$invalid||s.set(e.auth,s.buildUrl("/auths/secret"),{show:"auth_id,token",test:t.settings.test}).then(function(t){e.showToken=!0,e.auth.token=t.token},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateAuth=function(){c(),e.form.$invalid||(delete e.auth.effective_permissions,s.set(e.auth,e.url,{show:"auth_id,token"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",name:e.token,url:"#/auths/"+e.auth_id+"/edit"}),utils.redirect(i,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){s.remove(e.url).then(function(t){n.addGrowl({id:"delete_success",name:e.auth.token,type:"success"}),utils.redirect(i,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.addLimitedAuth=function(r){c();var i={headers:{Authorization:"Bearer "+localStorage.getItem("token"),Accept:"application/json;"}};0==r&&delete i.headers.Authorization;var n=a.post("https://"+t.apiHost+"/api/v1/auths/limited?account_id="+localStorage.getItem("account_id")+"&test="+r,null,i);n.success(function(t){e.showToken=!0,e.auth.token=t.token}),n.error(function(t){e.exception.error=t.error,window.scrollTo(0,0)})}}]),app.controller("CartsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.cartListUrl=s.buildUrl("/carts")}]),app.controller("CartsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,r,i,n){e.cart={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.resources={},e.functions={},e.url=r.buildUrl("/carts/"+t.id),e.resources.paymentListUrl=e.url+"/payments";var s={expand:"customer,items.product,payments,payments.payment_method",hide:"items.product.images",formatted:!0};r.getItem(e.url,s).then(function(t){e.cart=t,e.successful_payment=_.findWhere(e.cart.payments.data,{success:!0})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.$watch("successful_payment.status",function(t,r){e.successful_payment&&void 0!=r&&(e.cart.payment_status=e.successful_payment.status)})}]),app.controller("CustomersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.customers={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.date_type&&(e.params.date_type="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadCustomers=function(){s.getList(s.buildUrl("/customers?show=customer_id,name,email,has_payments,date_created&date_type="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.customers.customerList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null,e.setPagination(e.customers.customerList)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setPagination=function(t){e.nav.before_item=null,e.nav.after_item=null,t.data.length>0&&(null!=t.previous_page_url&&(e.nav.before_item=t.data[0].customer_id),null!=t.next_page_url&&(e.nav.after_item=t.data[t.data.length-1].customer_id))},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?(e.params.after_item=e.nav.after_item,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=e.nav.before_item),e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.date_type=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadCustomers()}),e.parseParams(),e.params.has_payments=!0,e.loadCustomers()}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,r,i,n,s,o){e.customer={},e.billing_address={},e.shipping_address={},e.cards=[],e.resources={},e.edit=!1,e.exception={},e.count={},e.count.orders=0,e.count.payments=0,e.count.subscriptions=0,e.count.refunds=0,e.count.invoices=0,e.url=n.buildUrl("/customers/"+t.id),e.resources.orderListUrl=e.url+"/orders",e.resources.subscriptionListUrl=e.url+"/subscriptions",e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.invoiceListUrl=e.url+"/invoices",n.getItem(e.url,{expand:"payment_methods"}).then(function(t){e.customer=t,e.payment_methods=t.payment_methods},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.refreshCards=function(){n.getList(e.url+"/payment_methods").then(function(t){e.payment_methods=t})}}]),app.controller("DashboardViewCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.dashboard={},e.exception={},e.url=s.buildUrl("/dashboard"),s.getItem(e.url).then(function(t){e.currency=t.currency,e.sales=[],_.each(t.sales,function(t){e.sales.push(t.total)}),e.sales_today=t.sales[29].total,e.sales_yesterday=t.sales[28].total;for(var r=0,i=0;r<e.sales.length;i+=e.sales[r++]);e.sales_month=i,e.new_subscriptions=[],_.each(t.new_subscriptions,function(t){e.new_subscriptions.push(t.total)}),e.new_subscriptions_today=t.new_subscriptions[29].total,e.new_subscriptions_yesterday=t.new_subscriptions[28].total;for(var r=0,i=0;r<e.new_subscriptions.length;i+=e.new_subscriptions[r++]);e.new_subscriptions_month=i,e.subscription_renewals=[],_.each(t.subscription_renewals,function(t){e.subscription_renewals.push(t.total)}),e.subscription_renewals_today=t.subscription_renewals[29].total,e.subscription_renewals_yesterday=t.subscription_renewals[28].total;for(var r=0,i=0;r<e.subscription_renewals.length;i+=e.subscription_renewals[r++]);e.subscription_renewals_month=i,e.total_subscriptions=[],_.each(e.new_subscriptions,function(t,r){e.total_subscriptions.push(utils.roundCurrency(t+e.subscription_renewals[r]))}),e.total_subscriptions_today=utils.roundCurrency(e.new_subscriptions[29]+e.subscription_renewals[29]),e.total_subscriptions_yesterday=utils.roundCurrency(e.new_subscriptions[28]+e.subscription_renewals[28]);for(var r=0,i=0;r<e.total_subscriptions.length;i+=e.total_subscriptions[r++]);e.total_subscriptions_month=i,e.cart_visitors=[],e.cart_visitors=_.pluck(t.cart_visitors,"value"),e.cart_visitors_today=t.cart_visitors[29].value,e.cart_visitors_yesterday=t.cart_visitors[28].value;for(var r=0,i=0;r<e.cart_visitors.length;i+=e.cart_visitors[r++]);e.cart_visitors_month=i,e.cart_conversions=[],e.cart_conversions=_.pluck(t.cart_conversions,"value"),e.cart_conversions_today=t.cart_conversions[29].value,e.cart_conversions_yesterday=t.cart_conversions[28].value;for(var r=0,i=0;r<e.cart_conversions.length;i+=e.cart_conversions[r++]);e.cart_conversions_month=i,e.cart_conversion_rates=[],e.cart_conversion_rates=_.pluck(t.cart_conversion_rates,"value"),e.cart_conversion_rates_today=t.cart_conversion_rates[29].value,e.cart_conversion_rates_yesterday=t.cart_conversion_rates[28].value,e.cart_conversion_rates_month=t.average_cart_conversion_rate,utils.renameProperty(t.customer_operating_systems,"item","label"),e.customer_operating_systems=t.customer_operating_systems,utils.renameProperty(t.customer_languages,"item","label"),e.customer_languages=t.customer_languages,utils.renameProperty(t.customer_browsers,"item","label"),e.customer_browsers=t.customer_browsers,utils.renameProperty(t.customer_locations,"item","label"),e.customer_locations=t.customer_locations,utils.renameProperty(t.customer_devices,"item","label"),e.customer_devices=t.customer_devices,utils.renameProperty(t.customer_new_vs_returning,"item","label"),e.customer_new_vs_returning=t.customer_new_vs_returning},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("FilesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.files={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadFiles=function(){s.getList(s.buildUrl("/files?show=file_id,filename,name,version,bytes,date_created"),e.params).then(function(t){e.files.fileList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.files.fileList.next_page_offset:e.params.offset=e.files.fileList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadFiles()}),e.parseParams(),e.loadFiles()}]),app.controller("FilesAddCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.file={},e.file.expires_in_days=7,e.file.expires_in_clicks=10,e.exception={},e.uploadSending=!1;e.$on("uploadSending",function(t,r){e.$apply(function(){e.uploadSending=r})}),e.$on("uploadDelete",function(t,i,o){var a={id:"delete"};a.onConfirm=function(){e.$broadcast("uploadDeleted",o),n.remove(i.url,null,!1),utils.redirect(r,"/files")},s.showConfirm(e,a)}),e.$on("uploadComplete",function(e,t){i.addGrowl({id:"add_success",name:t.name,type:"success",file_id:t.file_id,url:"#/files/"+t.file_id+"/edit"}),utils.redirect(r,"/files")});e.cancel=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(r,"/files")},s.showConfirm(e,t)}else utils.redirect(r,"/files")}}]),app.controller("FilesEditCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.file={},e.exception={},e.url=n.buildUrl("/files/"+t.id),e.uploadUrl="/files/"+t.id,n.getItem(e.url).then(function(t){e.file=t,e.file_orig=angular.copy(e.file)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.file,e.file_orig))utils.redirect(r,"/files");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/files")},s.showConfirm(e,t)}},e.uploadSending=!1;e.$on("uploadSending",function(t,r){e.$apply(function(){e.uploadSending=r})}),e.$on("uploadComplete",function(t,r){e.$apply(function(){e.file=r})});e.cancelUpload=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(r,"/files")},s.showConfirm(e,t)}else utils.redirect(r,"/files")};var o=function(){e.exception.error=null};e.updateFile=function(){o(),n.multipartForm(e.file,null,e.file.url,{show:"file_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(r,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteFile()},s.showConfirm(e,t)},e.deleteFile=function(){n.remove(e.file.url).then(function(){i.addGrowl({id:"delete_success",name:e.file.name,type:"success"}),utils.redirect(r,"/files")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GatewaysListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.gateways={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadGateways=function(){s.getList(s.buildUrl("/gateways?show=gateway_id,name,active,payment_method_type,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.gateways.gatewayList=t,e.gatewaysChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){function r(){e.successItems.length>0&&(1==t?n.addGrowl({id:"activate_success",count:e.successItems.length}):n.addGrowl({id:"inactivate_success",count:e.successItems.length}))}var o=_.where(e.gateways.gatewayList.data,{checked:!0});e.successItems=[],e.failItems=[];var a=(i.defer(),[]);_.each(o,function(r){a.push(s.set({gateway_id:r.gateway_id,active:t},r.url).then(function(t){r.active=t.active,e.successItems.push(r)},function(t){e.failItems.push(r),n.addGrowl({id:"active_change_failure",name:r.name,type:"danger"})}))}),i.all(a).then(r)},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.gateways.gatewayList.next_page_offset:e.params.offset=e.gateways.gatewayList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadGateways()}),e.checkGateway=function(t){t.checked?(t.checked=!1,e.gatewaysChecked=!1,_.each(e.gateways.gatewayList.data,function(t){t.checked&&(e.gatewaysChecked=!0)})):(t.checked=!0,e.gatewaysChecked=!0)},e.parseParams(),e.loadGateways()}]),app.controller("GatewaysSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,r,i,n,s,o){e.exception={},e.models={},e.models.selectedCurrencies=[],e.models.selectedCardTypes=[],e.showFields=!1,e.gateway_config={},null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/gateways/"+t.id),n.getItem(e.url,{show_sensitive:!0}).then(function(t){e.gateway=t,n.getItem(n.buildUrl("/gateways/options")).then(function(r){e.gateway_configs=r.gateway_configs,e.currencies=r.currencies,e.card_types=r.card_types,_.each(t.currencies,function(t){var r=_.findWhere(e.currencies,{code:t});null!=r&&e.models.selectedCurrencies.push(r)}),_.each(t.card_types,function(t){e.models.selectedCardTypes.push(t)}),e.loadFields(t.provider_id)},function(t){e.exception.error=t}),e.gateway_orig=angular.copy(e.gateway)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.gateway={active:!1,payment_method_type:"credit_card",currencies:[],card_types:[],fields:{}},n.getItem(n.buildUrl("/gateways/options")).then(function(t){e.gateway_configs=t.gateway_configs,e.currencies=t.currencies,e.card_types=t.card_types},function(t){e.exception.error=t}));var a=function(){e.exception.error=null,e.gateway.currencies=_.pluck(e.models.selectedCurrencies,"code"),e.gateway.card_types=e.models.selectedCardTypes};e.confirmCancel=function(){if(angular.equals(e.gateway,e.gateway_orig))utils.redirect(r,"/gateways");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/gateways")},s.showConfirm(e,t)}},e.addGateway=function(){a(),e.form.$invalid||n.set(e.gateway,n.buildUrl("/gateways"),{show:"gateway_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",gateway_id:e.gateway_id,url:"#/gateways/"+e.gateway_id+"/edit"}),o.setAccountMeta(),utils.redirect(r,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateGateway=function(){a(),e.form.$invalid||n.set(e.gateway,e.url,{show:"gateway_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/gateways/"+e.gateway_id+"/edit"}),o.setAccountMeta(),utils.redirect(r,"/gateways")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.loadGatewayConfig=function(t){e.gateway_config=_.findWhere(e.gateway_configs,{provider_id:e.gateway.provider_id}),1==e.gateway_config.payment_method_types.length&&(e.gateway.payment_method_type=e.gateway_config.payment_method_types[0]),e.loadFields(t)},e.loadFields=function(t){var r=_.findWhere(e.gateway_configs,{provider_id:t});r&&(r.fields.length>0?e.fields=r.fields:e.fields=null)},e.onCurrencySelect=function(t,r,i){_.findWhere(e.models.selectedCurrencies,{code:r.code})||e.models.selectedCurrencies.push(r),e.typeahead.currency=null},e.removeCurrency=function(t){e.models.selectedCurrencies=_.reject(e.models.selectedCurrencies,function(e){return e.code==t.code})},e.onCardTypeSelect=function(t,r,i){e.models.selectedCardTypes.push(r),e.typeahead.card_types=null},e.removeCardType=function(t){e.models.selectedCardTypes=_.reject(e.models.selectedCardTypes,function(e){return e==t})},e.supportsCreditCard=function(t){if(t&&e.gateway_configs){var r=_.findWhere(e.gateway_configs,{provider_id:e.gateway.provider_id});if(r&&r.payment_method_types.indexOf("credit_card")>-1)return!0}return!1},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.delete=function(){n.remove(e.url).then(function(){i.addGrowl({id:"delete_success",name:e.gateway.name,type:"success"}),utils.redirect(r,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("GettingStartedViewCtrl",["$scope","$q","$routeParams","ApiService","GrowlsService",function(e,t,r,i,n){var s=function(t){e.cartUrl="/#/app_installations"};e.account_id=localStorage.getItem("account_id"),s(utils.stringToBool(localStorage.getItem("test")))}]),app.controller("ImagesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.images={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!1)},e.loadImages=function(){s.getList(s.buildUrl("/images?show=image_id,filename,link_square,link_large,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.images.imageList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.images.imageList.next_page_offset:e.params.offset=e.images.imageList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params);
},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadImages()}),e.parseParams(),e.loadImages()}]),app.controller("ImagesAddCtrl",["$scope","$routeParams","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n){e.image={},e.exception={},e.state={},e.state.uploadSending=!1,e.state.uploadComplete=!1;e.$on("uploadSending",function(t,r){e.$apply(function(){e.state.uploadSending=r})});e.showDelete=!1,utils.hasPermission("images","delete")&&(e.showDelete=!0);e.$on("uploadDelete",function(t,r,s){var o={id:"delete"};o.onConfirm=function(){e.$broadcast("uploadDeleted",s),utils.hasPermission("images","delete")&&i.remove(r.url,null,!1)},n.showConfirm(e,o)}),e.$on("uploadComplete",function(t,r){e.state.uploadComplete=!0});e.cancel=function(){if(e.state.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect($location,"/images")},n.showConfirm(e,t)}else utils.redirect($location,"/images")}}]),app.controller("ImagesViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.image={},e.exception={},e.url=n.buildUrl("/images/"+t.id),n.getItem(e.url).then(function(t){e.image=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteImage()},s.showConfirm(e,t)},e.deleteImage=function(){n.remove(e.image.url).then(function(){i.addGrowl({id:"delete_success",name:e.image.filename,type:"success"}),utils.redirect(r,"/images")},function(t){window.scrollTo(0,0),e.exception=t})}}]),app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.invoiceListUrl=s.buildUrl("/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","ConfirmService","GrowlsService",function(e,t,r,i,n,s){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.count.notifications=0,e.resources={},e.functions={},e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.invoice.currency=localStorage.getItem("default_payment_currency");var o=new Date;o.setMonth(o.getMonth()+1),e.invoice.date_due=o,1==e.currencies.length&&(e.invoice.currency=e.currencies[0].code),e.itemPriceEdits={},e.itemQuantityEdits={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_due={opened:!1},e.datepicker.open=function(t,r){e.datepicker.status[r].opened=!0},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/invoices/"+t.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications",i.getItem(e.url,e.params).then(function(t){e.invoice=t,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0}),e.draft=e.invoice.draft},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)}):(e.url=i.buildUrl("/invoices"),e.invoice.items=[],e.invoice.autopay=!1,e.draft=!0,e.update=!1,e.add=!0),e.$watch("successful_payment.status",function(t,r){e.successful_payment&&void 0!=r&&(e.invoice.payment_status=e.successful_payment.status)}),e.functions.onCustomerSet=function(t){e.invoice.url&&(e.invoice.customer=t,e.backgroundUpdate())},e.backgroundUpdate=function(){e.invoice.autopay;return i.set(e.invoice,e.url,e.params).then(function(t){e.invoice=t,e.invoice.autopay=!1,e.invoice.customer&&e.invoice.customer.payment_methods&&e.invoice.customer.payment_methods.length>0&&(e.invoice.autopay=!0)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.save=function(t){i.set(e.invoice,e.url).then(function(e){s.addGrowl({id:"edit_success",name:"Invoice "+e.invoice_id,type:"success",url:"#/invoices/"+e.invoice_id}),utils.redirect(r,"/invoices")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.editItemPrice=function(t){var r={reference_price:t.reference_price,reference_currency:t.reference_currency};null==t.reference_price&&(t.reference_price=t.price),null==t.reference_currency&&(t.reference_currency=t.currency),e.itemPriceEdits[t.item_id]=r,e.itemEdits=!0},e.editItemQuantity=function(t,r){if(!e.itemQuantityEdits[t.item_id]){var i={quantity:r};e.itemQuantityEdits[t.item_id]=i,e.itemEdits=!0}},e.cancelItemsEdit=function(t){for(var r in e.itemPriceEdits)if(e.itemPriceEdits.hasOwnProperty(r)){var i=_.findWhere(t,{item_id:r});i&&(i.reference_price=e.itemPriceEdits[r].reference_price,i.reference_currency=e.itemPriceEdits[r].reference_currency)}for(var r in e.itemQuantityEdits)if(e.itemQuantityEdits.hasOwnProperty(r)){var i=_.findWhere(t,{item_id:r});i&&(i.quantity=e.itemQuantityEdits[r].quantity)}e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},e.applyItemEdits=function(){e.exception.error=null,e.backgroundUpdate().then(function(t){e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},function(t){window.scrollTo(0,0),e.exception.error=t})},e.removeCustomer=function(){e.invoice.customer=null,e.invoice.customer_id=null,e.invoice.url&&e.backgroundUpdate()},e.save=function(){var t=e.invoice.draft;e.invoice.draft=e.draft,i.set(e.invoice,e.url,e.params).then(function(e){s.addGrowl({id:"edit_success",name:"invoice "+e.invoice_id,type:"success",url:"#/invoices/"+e.invoice_id}),utils.redirect(r,"/invoices")},function(r){e.exception.error=r,e.invoice.draft=t,window.scrollTo(0,0)})},e.setShipping=function(t){return e.invoice.shipping_method_id=t,e.backgroundUpdate()},e.publish=function(){e.draft=!1,e.invoice.draft=!1,i.set(e.invoice,e.url,e.params).then(function(e){s.addGrowl({id:"invoice_published",type:"success"})},function(t){e.draft=!0,e.invoice.draft=!0,e.exception.error=t,window.scrollTo(0,0)})},e.send=function(){i.set(null,e.url+"/send").then(function(e){s.addGrowl({id:"invoice_sent",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.delete=function(){i.remove(e.url).then(function(){s.addGrowl({id:"delete_success",name:"invoice "+e.invoice.invoice_id,type:"success"}),utils.redirect(r,"/invoices")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/invoices")},n.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},n.showConfirm(e,t)},e.downloadPdf=function(){i.getItemPdf(e.url).then(function(t){var r=new Blob([t],{type:"application/pdf"});saveAs(r,"Invoice_"+e.invoice.invoice_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("LicenseServicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.license_services={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadLicenseServices=function(){s.getList(s.buildUrl("/license_services?show=license_service_id,name,type,configuration.license_count,configuration.notify_at_count,date_created"),e.params).then(function(t){e.license_services.license_serviceList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.license_services.license_serviceList.next_page_offset:e.params.offset=e.license_services.license_serviceList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadLicenseServices()}),e.parseParams(),e.loadLicenseServices()}]),app.controller("LicenseServicesSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.licenses={},e.licenses.list=null,e.exception={},e.license_service={},e.license_service.type="list",e.license_service.configuration={},e.license_service.configuration.format="json",e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100,null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/license_services/"+t.id),n.getItem(e.url).then(function(t){e.license_service=t,"list"==e.license_service.type&&(e.licenses.list=utils.arrayToString(e.license_service.configuration.licenses),e.license_service.configuration.format="json"),"remote_url"==e.license_service.type&&(e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var o=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/license_services")},s.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addLicenseService=function(){return o(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),void n.set(e.license_service,n.buildUrl("/license_services"),{show:"license_service_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),window.location="#/license_services"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateLicenseService=function(){o(),e.form.$invalid||(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),n.set(e.license_service,e.url,{show:"license_service_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),utils.redirect(r,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){n.remove(e.license_service.url).then(function(t){i.addGrowl({id:"delete_success",name:e.license_service.name,type:"success"}),utils.redirect(r,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.notificationListUrl=s.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,t,r,i,n){e.notification={},e.exception={},e.url=r.buildUrl("/notifications/"+t.id),e.previewUrl=null,e.showResend=!1;var s={expand:"customer",hide:"data"};r.getItem(e.url,s).then(function(t){e.notification=t,e.previewUrl=n.trustAsResourceUrl("/app/pages/notifications/preview/index.html?notification_id="+t.notification_id),e.email=t.customer.email},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.resend=function(t){if(!t.$invalid){var n={destination:e.email};r.set(n,e.url+"/resend",{show:"notification_id"}).then(function(t){i.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,t,r){e.notification={},e.exception={},e.url=r.buildUrl("/notifications/"+t.id);var i={show:"body"};r.getItem(e.url,i).then(function(t){e.notification=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.orderListUrl=s.buildUrl("/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,r,i,n){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=r.buildUrl("/orders/"+t.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var s={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};r.getItem(e.url,s).then(function(t){e.order=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.$watch("order.fulfilled",function(t,r){0==r&&1==t&&"pending"==e.order.payment.status&&"credit_card"==e.order.payment.payment_method.type&&(n.addGrowl({id:"payment_capture_scheduled",type:"success"}),e.order.hideCapture=!0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.downloadPdf=function(){r.getItemPdf(e.url).then(function(t){var r=new Blob([t],{type:"application/pdf"});saveAs(r,"Order_"+e.order.order_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("PaymentsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.paymentListUrl=s.buildUrl("/payments")}]),app.controller("PaymentsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,r,i,n){e.payment={},e.exception={},e.fee_currency=null,e.currencyType="transaction",e.prefs={},e.prefs.loadRefundDetails=!1,e.url=r.buildUrl("/payments/"+t.id),e.refundListUrl=e.url+"/refunds";var s={expand:"customer,payment_method,response_data,gateway,fees,commissions,order,refunds.items"};r.getItem(e.url,s).then(function(t){e.payment=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("ProductsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.products={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadProducts=function(){s.getList(s.buildUrl("/products?show=product_id,name,active,price,currency,deleted,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.products.productList=t,e.productsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){function r(){e.successItems.length>0&&(1==t?n.addGrowl({id:"activate_success",count:e.successItems.length}):n.addGrowl({id:"inactivate_success",count:e.successItems.length}))}var o=_.where(e.products.productList.data,{checked:!0});e.successItems=[],e.failItems=[];var a=(i.defer(),[]);_.each(o,function(r){a.push(s.set({product_id:r.product_id,active:t},r.url).then(function(t){r.deleted=t.deleted,r.active=t.active,e.successItems.push(r)},function(t){e.failItems.push(r),n.addGrowl({id:"active_change_failure",name:r.name,type:"danger"})}))}),i.all(a).then(r)},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.products.productList.next_page_offset:e.params.offset=e.products.productList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadProducts()}),e.checkProduct=function(t){t.checked?(t.checked=!1,e.productsChecked=!1,_.each(e.products.productList.data,function(t){t.checked&&(e.productsChecked=!0)})):(t.checked=!0,e.productsChecked=!0)},e.parseParams(),e.loadProducts()}]),app.controller("ProductsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.data={},null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/products/"+t.id),n.getItem(e.url,{expand:"file,images,subscription_plan,license_service"}).then(function(t){e.product=t,null==e.product.weight&&(e.product.weight={unit:"oz"}),e.data.file=t.file,e.data.images=t.images,e.data.subscription_plan=t.subscription_plan,e.data.license_service=t.license_service,delete e.product.file,delete e.product.images,delete e.product.subscription_plan,delete e.product.license_service;for(var r=0;r<e.product.prices.length;r++)e.product.prices[r].price=utils.cleanPrice(e.product.prices[r].price);e.product_orig=angular.copy(e.product)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.product={active:!1,description:"",prices:[],weight:{}},e.data.images=[],e.account_id=localStorage.getItem("account_id"),e.product.active=!1,e.product.hidden=!1,e.product.weight.unit="oz",e.product.prices.push({price:"",currency:""})),e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.removeFile=function(){e.product.file_id=null,e.data.file=null,e.showFile=!1},e.removeSubscriptionPlan=function(){e.product.subscription_plan_id=null,e.data.subscription_plan=null,e.showSubscriptionPlan=!1},e.removeLicenseService=function(){e.product.license_service_id=null,e.data.license_service=null,e.showLicenseService=!1};var o=function(){e.exception.error=null,e.product.prices=utils.removeEmptyPrices(e.product.prices),e.product.weight&&(null!=e.product.weight.amount&&""!=e.product.weight.amount||(e.product.weight=null)),0==e.product.prices.length&&e.product.prices.push({price:"",currency:""}),null!=e.data.file&&(e.product.file_id=e.data.file.file_id),null!=e.data.images&&_.each(e.data.images,function(t){null==e.product.image_ids&&(e.product.image_ids=[]),e.product.image_ids.push(t.image_id)}),null!=e.data.subscription_plan&&(e.product.subscription_plan_id=e.data.subscription_plan.subscription_plan_id),null!=e.data.license_service&&(e.product.license_service_id=e.data.license_service.license_service_id)};e.confirmCancel=function(){if(angular.equals(e.product,e.product_orig))utils.redirect(r,"/products");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/products")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addProduct=function(){return o(),e.form.$invalid?void window.scrollTo(0,0):void n.set(e.product,n.buildUrl("/products"),{show:"product_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",product_id:e.product_id,url:"#/products/"+e.product_id+"/edit"}),utils.redirect(r,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateProduct=function(){o(),e.form.$invalid||n.set(e.product,e.url,{show:"product_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/products/"+e.product_id+"/edit"}),utils.redirect(r,"/products")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){n.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.product.name,type:"success",url:"#/products/"+e.product.product_id+"/edit"}),utils.redirect(r,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){n.set({deleted:!1},e.url,{show:"product_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.product.name,type:"success",product_id:e.product.product_id,url:"#/products/"+t.product_id+"/edit"}),utils.redirect(r,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("ProfileUpdateCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.url=n.buildUrl("/users/me"),n.getItem(e.url).then(function(t){e.user=t,e.user_orig=angular.copy(e.user)},function(t){e.exception.error=t,window.scrollTo(0,0)});var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.user,e.user_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateProfile=function(t){if(o(),e.user.password||e.user.password2){if(e.user.password!=e.user.password2)return void t.password2.$setValidity("match",!1);t.password2.$setValidity("match",!0)}else t.password2.$setValidity("match",!0);e.form.$invalid||(utils.isNullOrEmpty(e.user.password)&&(delete e.user.password,delete e.user.password2),n.set(e.user,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"your profile",type:"success",url:"#/profile"}),utils.redirect(r,"/")},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("RefundsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.refundListUrl=s.buildUrl("/refunds")}]),app.controller("RefundsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,r,i,n){e.refund={},e.exception={},e.fee_currency=null,e.items=[],e.currencyType="transaction",e.prefs={},e.prefs.loadRefundDetails=!1,e.url=r.buildUrl("/refunds/"+t.id);var s={expand:"payment,customer,payment_method,gateway,fees,commissions,order,refunds.items"};r.getItem(e.url,s).then(function(t){e.refund=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency),null!=t.order&&(e.items=t.order.items)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("ReportCommissionsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,r,i,n,s,o){e.exception={},e.timezones=o.getTimezones(),e.url=n.buildUrl("/reports/commissions"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,r){e.datepicker.status[r].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var r=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":r=-29,date_end=0;break;case"last_7":r=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),r=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(r=null,date_end=null);var i=e.options.accounting_id;"date"==e.options.search_by&&(i=null);var s=e.options.currency;"Actual"==s&&(s=null),n.getItem(e.url,{category:e.options.category,currency:s,accounting_id:i,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:r,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(r){e.data[t.currency].data.push(r.total),e.data[t.currency].labels.push(r.type.split("_").join(" ")),e.data[t.currency].values.push(r.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},r=[],i=[],n=[];return _.each(e.breakdowns,function(e){r.push(e.total),i.push(e.name),n.push(e.formatted.total)}),t.data=r,t.labels=i,t.values=n,t},e.downloadCsv=function(t,r){var i="all";if(e.options.category&&(i=e.options.category),"doc"==e.options.search_by)var n="commissionss_"+i+"_"+r+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var n="commissionss_"+i+"_"+r+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=r}),utils.jsonToCsvDownload(t,n)},e.run()}]),app.controller("ReportFeesController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,r,i,n,s,o){e.exception={},e.timezones=o.getTimezones(),e.url=n.buildUrl("/reports/fees"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,r){e.datepicker.status[r].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var r=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":r=-29,date_end=0;break;case"last_7":r=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),r=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(r=null,date_end=null);var i=e.options.accounting_id;"date"==e.options.search_by&&(i=null);var s=e.options.currency;"Actual"==s&&(s=null),n.getItem(e.url,{category:e.options.category,currency:s,accounting_id:i,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:r,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(r){e.data[t.currency].data.push(r.total),e.data[t.currency].labels.push(r.type.split("_").join(" ")),e.data[t.currency].values.push(r.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},r=[],i=[],n=[];return _.each(e.breakdowns,function(e){r.push(e.total),i.push(e.name),n.push(e.formatted.total)}),t.data=r,t.labels=i,t.values=n,t},e.downloadCsv=function(t,r){var i="all";if(e.options.category&&(i=e.options.category),"doc"==e.options.search_by)var n="fees_"+i+"_"+r+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var n="fees_"+i+"_"+r+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=r}),utils.jsonToCsvDownload(t,n)},e.run()}]),app.controller("ReportItemsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,r,i,n,s,o){e.exception={},e.timezones=o.getTimezones(),e.url=n.buildUrl("/reports/items"),e.options={},e.options.type="combined",e.options.desc="true",e.options.sort_by="subtotal",e.options.timezone="UTC",e.options.dates="yesterday",e.options.currency="USD",e.options.offset="0",e.options.labels=[],e.options.values=[],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,r){e.datepicker.status[r].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var r=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":r=-29,date_end=0;break;case"last_7":r=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),r=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}n.getItem(e.url,{type:e.options.type,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:r,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total),e.options.labels.push(t.name),e.options.values.push(t.formatted.total)}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.movePage=function(t){"+"==t?e.options.offset=e.report.next_page_offset:e.options.offset=e.report.previous_page_offset,e.nav.scrollTop=!0,e.run()},e.downloadCsv=function(t){var r="sales_by_product_"+e.report.type+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");utils.jsonToCsvDownload(t,r)},e.run()}]),app.controller("ReportSalesCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,r,i,n,s,o){e.exception={},e.timezones=o.getTimezones(),e.url=n.buildUrl("/reports/sales"),e.options={},e.options.type="combined",e.options.segment="all",e.options.group_by="day",e.options.timezone="UTC",e.options.dates="last_30",e.options.currency="USD",e.options.labels=[],e.options.values=[],e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,r){e.datepicker.status[r].opened=!0},e.run=function(){e.exception={};var t=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":t=-29,date_end=0;break;case"last_7":t=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),t=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}n.getItem(e.url,{type:e.options.type,group_by:e.options.group_by,timezone:e.options.timezone,segment:e.options.segment,date_start:t,date_end:date_end,formatted:!0}).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total-t.tax),e.options.labels.push(t.total),e.options.values.push(t.formatted.total)})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadCsv=function(t){var r="sales_"+e.report.type+"_"+e.report.segment+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");
utils.jsonToCsvDownload(t,r)},e.run()}]),app.controller("AnalyticsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.url=n.buildUrl("/settings/analytics"),n.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){o(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),n.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Analytics Settings",type:"success",url:"#/settings/analytics"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("FulfillmentSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.url=n.buildUrl("/settings/fulfillment"),n.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){o(),e.form.$invalid||n.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Fulfillment Settings",type:"success",url:"#/settings/fulfillment"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GeneralSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,r,i,n,s,o,a,c){e.exception={},e.url=n.buildUrl("/settings/general"),e.currencies=o.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,n.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,r,i,n){e.settings["reporting_currency_"+n]=r.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void n.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"General Settings",type:"success",url:"#/settings/general"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("PaymentSettingsCtrl",["$scope","$routeParams","$location","$timeout","GrowlsService","ApiService","ConfirmService","CurrenciesService","HelperService",function(e,t,r,i,n,s,o,a,c){function l(e,t){return _.each(e,function(e){t[e]=!0}),t}function u(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&1==e[r]&&t.push(r);return t}e.exception={},e.url=s.buildUrl("/settings/payment"),e.currencies=a.getCurrencies(),e.required_fields={},e.optional_fields={},e.helperService=c,s.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.default_payment_currency=_.find(e.currencies,{code:t.default_payment_currency}),e.refund_reasons=utils.arrayToString(t.refund_reasons),e.chargeback_reasons=utils.arrayToString(t.chargeback_reasons),e.blocked_countries=utils.arrayToString(t.blocked_countries),e.required_fields=l(t.customer_required_fields,e.required_fields),e.optional_fields=l(t.customer_optional_fields,e.optional_fields),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCurrencySelect=function(t,r,i,n){e.settings[n]=r.code},e.toggleCustomerRequiredField=function(t){e.required_fields[t]&&(e.optional_fields[t]=!1)},e.toggleCustomerOptionalField=function(t){e.optional_fields[t]&&(e.required_fields[t]=!1)};var p=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},o.showConfirm(e,t)}},e.updateSettings=function(t){p(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),null!=e.blocked_countries&&(e.settings.blocked_countries=utils.stringToArray(e.blocked_countries)),e.settings.customer_required_fields=u(e.required_fields),e.settings.customer_optional_fields=u(e.optional_fields),s.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Payment Settings",type:"success",url:"#/settings/payment"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("SubscriptionsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.url=n.buildUrl("/settings/subscription"),n.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings),e.cancellation_reasons=utils.arrayToString(t.cancellation_reasons)},function(t){e.exception.error=t,window.scrollTo(0,0)});var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){o(),e.form.$invalid||(null!=e.cancellation_reasons&&(e.settings.cancellation_reasons=utils.stringToArray(e.cancellation_reasons)),n.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Subscription Settings",type:"success",url:"#/settings/subscription"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("TechnicalSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,r,i,n,s,o,a,c){e.exception={},e.url=n.buildUrl("/settings/technical"),e.currencies=o.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,n.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,r,i,n){e.settings["reporting_currency_"+n]=r.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(r,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/")},s.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void n.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Technical Settings",type:"success",url:"#/settings/technical"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.exception={},e.resources={},e.resources.subscriptionListUrl=s.buildUrl("/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.url=n.buildUrl("/subscriptions/"+t.id),e.resources.invoiceListUrl=e.url+"/invoices",n.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,item.product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.uncancel=function(){var t={cancel_at_current_period_end:!1};n.set(t,e.url,{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("SubscriptionPlansListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.subscription_plans={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadSubscriptionPlans=function(){s.getList(s.buildUrl("/subscription_plans?show=subscription_plan_id,name,billing_interval,billing_interval_unit,trial_interval,trial_interval_unit,end_at_billing_count,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.subscription_plans.subscription_planList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.subscription_plans.subscription_planList.next_page_offset:e.params.offset=e.subscription_plans.subscription_planList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadSubscriptionPlans()}),e.parseParams(),e.loadSubscriptionPlans()}]),app.controller("SubscriptionPlansSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/subscription_plans/"+t.id),n.getItem(e.url).then(function(t){e.subscription_plan=t,e.subscription_plan_orig=angular.copy(e.subscription_plan)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.subscription_plan={},e.subscription_plan.fulfill_on_renewal=!1,e.subscription_plan.order_confirmation_on_renewal=!0,e.subscription_plan.trial_interval_unit=null,e.subscription_plan.billing_interval_unit="month");var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.subscription_plan,e.subscription_plan_orig))utils.redirect(r,"/subscription_plans");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/subscription_plans")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addSubscriptionPlan=function(){return o(),e.form.$invalid?void window.scrollTo(0,0):void n.set(e.subscription_plan,n.buildUrl("/subscription_plans"),{show:"subscription_plan_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(r,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateSubscriptionPlan=function(){return o(),e.form.$invalid?void window.scrollTo(0,0):((utils.isNullOrEmpty(e.subscription_plan.trial_interval_unit)||utils.isNullOrEmpty(e.subscription_plan.trial_interval))&&(e.subscription_plan.trial_interval_unit=null,e.subscription_plan.trial_interval=null),void n.set(e.subscription_plan,e.url,{show:"subscription_plan_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(r,"/subscription_plans")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){n.remove(e.url).then(function(t){i.addGrowl({id:"delete_success_with_undelete",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan.subscription_plan_id+"/edit"}),utils.redirect(r,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){n.set({deleted:!1},e.url,{show:"subscription_plan_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+t.subscription_plan_id+"/edit"}),utils.redirect(r,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("UsersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,r,i,n,s){e.users={},e.nav={},e.exception={},e.parseParams=function(){e.params=r.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!0)},e.loadUsers=function(){s.getList(s.buildUrl("/users?show=user_id,name,date_last_login,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.users.userList=t,e.usersChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,r.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),r.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.users.userList.next_page_offset:e.params.offset=e.users.userList.previous_page_offset,e.nav.scrollTop=!0,r.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,r.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadUsers()}),e.parseParams(),e.loadUsers()}]),app.controller("UsersSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,r,i,n,s){e.exception={},e.data={},null!=t.id?(e.update=!0,e.add=!1,e.url=n.buildUrl("/users/"+t.id),n.getItem(e.url).then(function(t){e.usr=t,e.usr_orig=angular.copy(e.usr)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var o=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.usr,e.usr_orig))utils.redirect(r,"/users");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(r,"/users")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addUser=function(){return o(),e.form.$invalid?void window.scrollTo(0,0):(e.usr.password=e.data.password,void n.set(e.usr,n.buildUrl("/users"),{show:"user_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",user_id:e.usr_id,url:"#/users/"+e.usr_id+"/edit"}),utils.redirect(r,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateUser=function(){o(),e.form.$invalid||(utils.isNullOrEmpty(e.data.password)?delete e.usr.password:e.usr.password=e.data.password,n.set(e.usr,e.url,{show:"user_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/users/"+e.usr_id+"/edit"}),utils.redirect(r,"/users")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){n.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.usr.name,type:"success",url:"#/users/"+e.usr.usr_id+"/edit"}),utils.redirect(r,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(t="api-staging.comecero.com");var r=utils.getPageQueryParameters(),i="https://"+t+"/api/v1/notifications/"+r.notification_id+"?show=body";r.notification_id&&$.ajax({type:"GET",url:i,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});